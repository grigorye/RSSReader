(function ioTrackingCode(){"use strict";try{if(typeof IO=="undefined")var IO={};if(document.cookie.indexOf("__io_window=1")!==-1)window.IO=IO;IO.defaults={trackingHost:"tt.onthe.io",projectId:"41585",projectSignature:"43ea103e0a706f8476dfafed908d97f5",projectCodeId:"WXdReCV6CibX",projectCodeVersion:"39",projectUniquesBySuperdomain:"0",projectVisitsBySuperdomain:"0",holdingHash:"4d50312f120e797c7ffca7593bbde3c1",holdingId:"41585",excludeReferrersByDomain:"the-village.ru"};if(typeof IO=="undefined")var IO={};IO.doubleLoadingDetector=function exportDoubleLoadingDetector(document,defaults){var exports={};exports.init=function(){var scripts=document.getElementsByTagName("script");var count=0;var i;for(i=0;i<scripts.length;i++){if((scripts[i].getAttribute("src")||"").indexOf("io.js/"+defaults.projectCodeId)!==-1){count++}}if(count>1)return true};return exports}(document,IO.defaults);if(typeof IO=="undefined")var IO={};IO.helpers=function exportHelpers(window,document,defaults){var exports={};exports.decodeURIrecursively=function(text){try{while(decodeURIComponent(text)!=text){text=decodeURIComponent(text)}}catch(error){}return text};exports.encodeURIonce=function(text){return encodeURIComponent(this.decodeURIrecursively(text))};exports.bindOnUrlChange=function(callback){var previousPathname=window.location.pathname;this.addEventListenerSafe(document,"DOMSubtreeModified",function(){if(window.location.pathname===previousPathname)return;previousPathname=window.location.pathname;callback()})};exports.bindOnElementInsertion=function(selector,callback,parentElement){if(!parentElement)parentElement=document;var savedElements=parentElement.querySelectorAll(selector);savedElements=window.Array.prototype.slice.call(savedElements);this.addEventListenerSafe(parentElement,"DOMSubtreeModified",function(){var currentElements=parentElement.querySelectorAll(selector);var i,currentElement;for(i=0;i<currentElements.length;i++){currentElement=currentElements[i];if(window.Array.prototype.indexOf.call(savedElements,currentElement)==-1){savedElements.push(currentElement);callback(currentElement)}}})};exports.getSemeOriginFrames=function(parentElement){if(!parentElement)parentElement=document;var frames=parentElement.getElementsByTagName("iframe");var framesSameOrigin=[];var i=0;for(;i<frames.length;i++){if(!frames[i].src||frames[i].src.indexOf(window.location.origin)===0){framesSameOrigin.push(frames[i])}}return framesSameOrigin};exports.getRemoteContent=function(url,callback){var httpRequest=new XMLHttpRequest;httpRequest.onreadystatechange=function(){if(this.readyState!==XMLHttpRequest.DONE)return;if(this.status===200){callback(this.responseText)}else{callback(void 0)}};httpRequest.open("GET",url,true);httpRequest.send()};exports.getEnumerableKeys=function(object){var enumerableKeys=[];var key;for(key in object){if(!object.hasOwnProperty(key))continue;enumerableKeys.push(key)}return enumerableKeys};exports.getDeepPropertySafe=function(object,path){for(var i=0;i<path.length;i++){object=object[path[i]]}return object};exports.getDeepPropertySafe=function(object,path){var i;try{for(i=0;i<path.length;i++){object=object[path[i]]}return object}catch(error){return void 0}};exports.parseJSONSafe=function(data){try{return window.JSON.parse(data)}catch(error){return void 0}};exports.parseURL=function(text){var anchor=document.createElement("a");anchor.href=text;var url={hash:anchor.hash,hostname:anchor.hostname,href:anchor.href,origin:anchor.origin,pathname:anchor.pathname,port:anchor.port,protocol:anchor.protocol,search:anchor.search};if(url.pathname.charAt(0)!=="/"){url.pathname="/"+url.pathname}return url};exports.messageWindow=function(windowObject,messageObject){windowObject.postMessage(JSON.stringify(messageObject),"*")};exports.messageFrameWindow=function(frameElement,messageObject){this.messageWindow(frameElement.contentWindow,messageObject)};exports.createObject=function(prototypeObject){if(typeof window.Object.create==="function"){return window.Object.create(prototypeObject)}function throwAwayFunction(){}throwAwayFunction.prototype=prototypeObject;return new throwAwayFunction};exports.cloneObjectShallow=function(object){return window.JSON.parse(window.JSON.stringify(object))};exports.identifyArray=function(object){return Object.prototype.toString.call(object)==="[object Array]"?true:false};exports.getServerFrinedlyVersionOfSlices=function(slices){slices=this.cloneObjectShallow(slices);var decodableByServerSlices=["page","previous_page","title","url","pr","link_url"];function encodeCharacter(character){return"#"+character.charCodeAt(0)+";"}var currentSliceName;for(currentSliceName in slices){if(!slices.hasOwnProperty(currentSliceName))continue;if(decodableByServerSlices.indexOf(currentSliceName)!==-1){slices[currentSliceName]=slices[currentSliceName].replace(/[:,]/g,encodeCharacter)}slices[currentSliceName]=String.prototype.replace.call(slices[currentSliceName],/[:,]/g,"");slices[currentSliceName]=this.encodeURIonce(slices[currentSliceName])}return slices};exports.setIntervalSafe=function(scope,callback,interval){return scope.setInterval(function invokeIntervalInsideAWrapper(){try{callback.apply(null,arguments)}catch(error){this.trackErrorMetric(error)}}.bind(this),interval)};exports.addEventListenerSafe=function(element,eventName,callback){var boundedWrapper=function callListenerInsideAWrapper(){try{callback.apply(null,arguments)}catch(error){this.trackErrorMetric(error)}}.bind(this);element.addEventListener(eventName,boundedWrapper);return boundedWrapper};exports.trackErrorMetric=function(error,name){name=name||"error_script";var slices={title:typeof error==="string"?error:error.message+"\n\n"+error.stack,href:window.location.href,url:window.location.pathname,page:document.title,domain:window.location.hostname,user_agent:window.navigator.userAgent,pr:this.parseURL(document.referrer).pathname,device:this.getDeviceName(),browser_version:this.getBrowserNameAndVersion(),browser:this.getBrowserName(),referrer:this.getReferrer(),depth:this.getDepth(),user_type:this.getUserType()};if(document.cookie.indexOf("__io_error=1")!==-1){return window.console.error(error)}this.sendMetric(name,slices)};exports.getMetricParamString=function(name,slices){slices=this.getServerFrinedlyVersionOfSlices(slices);slices.cdn_version=defaults.projectCodeVersion;var slicesPrepared=[];for(var sliceName in slices){if(slices.hasOwnProperty(sliceName)){slicesPrepared.push(sliceName+":"+slices[sliceName])}}var metric=name+"["+slicesPrepared.join()+"]";metric=metric.replace(/\\x([0-9A-Fa-f]{2})/g,function(){return String.fromCharCode(parseInt(arguments[1],16))});return"?k[]="+defaults.projectId+":"+metric};exports.deferMetricToSendInBatch=function(name,slices,inludeUserId){if(!this.identifyArray(this.deferMetricToSendInBatch.metrics)){this.deferMetricToSendInBatch.metrics=[]}this.deferMetricToSendInBatch.metrics.push(this.getMetricParamString(name,slices));if(this.deferMetricToSendInBatch.intervalIsSet){return}this.deferMetricToSendInBatch.intervalIsSet=true;var interval=this.setIntervalSafe(window,function(){if(this.deferMetricToSendInBatch.metrics.length===0){this.deferMetricToSendInBatch.intervalIsSet=false;window.clearInterval(interval);return}var metrics="";while(this.deferMetricToSendInBatch.metrics.length&&(metrics+this.deferMetricToSendInBatch.metrics[0]).length<6e3){metrics+=this.deferMetricToSendInBatch.metrics.shift()}var request=new Image;request.src="https://"+defaults.trackingHost+"/"+metrics+"&s="+defaults.projectSignature+(inludeUserId?"&__io="+this.getUserId():"")+"&"+Date.now()}.bind(this),1e3)};exports.sendMetric=function(name,slices,numberOfRepeats,inludeUserId){var request=new Image;request.src="https://"+defaults.trackingHost+"/"+this.getMetricParamString(name,slices)+"&s="+defaults.projectSignature+(numberOfRepeats?"&_v="+numberOfRepeats:"")+(inludeUserId?"&__io="+this.getUserId():"")+"&"+Date.now();if(window===window.top)return;this.messageWindow(window.top,{event:"ioMetricSent",info:{name:name,slices:slices}})};exports.hashFnv32a=function(str,asString,seed){var i,l,hval=seed===void 0?2166136261:seed;for(i=0,l=str.length;i<l;i++){hval^=str.charCodeAt(i);hval+=(hval<<1)+(hval<<4)+(hval<<7)+(hval<<8)+(hval<<24)}if(asString)return("0000000"+(hval>>>0).toString(16)).substr(-8);return hval>>>0};exports.getStorageStatus=function(){try{window.sessionStorage.setItem("test","1");window.sessionStorage.removeItem("test");return true}catch(error){return false}};exports.getPreviousPageRelativeURI=function(currentURI){var storedURI;if(this.getStorageStatus()){storedURI=window.sessionStorage.getItem("__io_previous_page_uri");window.sessionStorage.setItem("__io_previous_page_uri",currentURI);if(storedURI&&currentURI!==storedURI){return storedURI}}else{storedURI=this.getPreviousPageRelativeURI.storedURI;this.getPreviousPageRelativeURI.storedURI=currentURI;if(storedURI&&currentURI!==storedURI){return storedURI}}if(document.referrer){var anchor=this.parseURL(document.referrer);if(anchor.hostname!==window.location.hostname)return;return anchor.pathname}};exports.getSearchParam=function(name){var match=window.location.search.match("[?&]"+name+"=([^(&?)]*)");return match?match[match.length-1]:""};exports.getCookieValue=function(name){var match=document.cookie.match("(^|;)\\s*"+name+"\\s*=\\s*([^;]+)");return match?this.decodeURIrecursively(match[match.length-1]):""};exports.getDepth=function(){var dateIn15min=new Date((new Date).getTime()+15*60*1e3).toUTCString();var depthDefault=1;var pathnameHash=this.hashFnv32a(window.location.pathname);var cookieName="__io_d";var cookieValue=this.getCookieValue(cookieName);if(!cookieValue||cookieValue.split("_").length!==2){document.cookie=cookieName+"="+depthDefault+"_"+pathnameHash+"; expires="+dateIn15min+";  path=/";return depthDefault}var pathnameHashPrevious=cookieValue.split("_")[1];var depthPrevious=window.parseInt(cookieValue.split("_")[0],10);if(pathnameHash==pathnameHashPrevious){return depthPrevious||1}var depthNew=(depthPrevious||0)+1;document.cookie=cookieName+"="+depthNew+"_"+pathnameHash+"; expires="+dateIn15min+";  path=/";return depthNew};exports.getUserId=function(){var _io=this.getCookieValue("__io");if(!_io){var _t=new Date;_t.setYear(_t.getFullYear()+1);var _tv=Math.floor((1+Math.random())*68719476736).toString(16).substring(1)+"."+Math.floor((1+Math.random())*68719476736).toString(16).substring(1);_io=_tv+"_"+ +Date.now();document.cookie="__io="+_io+"; expires="+_t.toUTCString()+"; path=/"}else{var _t=new Date;_t.setYear(_t.getFullYear()+1);document.cookie="__io="+_io+"; expires="+_t.toUTCString()+"; path=/"}return _io};exports.getReferrer=function(){var _io_source_for_referrer=function(ret){var pars=[];if(location.search)pars=location.search.substr(1).split(/&/);for(var i=0;i<pars.length;i++){var p=pars[i].split("=");if(p[0].indexOf("utm_")==0&&p[0].substr(4).match(/^[a-z]+$/)){var v=p[1],utm_name=p[0].substr(4),utm_value=v}}if(document.cookie.indexOf("__io_utm=")!==-1){var utm=document.cookie.match(/__io_utm=([^;]+)/);utm=utm[1].split("|||");for(var i=0;i<utm.length;i++){var v=utm[i].split(":"),utm_name=v[0],utm_value=v[1]}}return ret};var ref=document.referrer;var utm_source=this.getSearchParam("utm_source");if(utm_source=="mail"){ref="mail"}else if(utm_source&&ref==""){ref=utm_source}var io_utm_social=this.getSearchParam("io_utm_social");if(io_utm_social){ref=io_utm_social}if(location.search.indexOf("utm_referrer=https%3A%2F%2Fzen.yandex.com")>-1||location.search.indexOf("utm_referrer=https%3A%2F%2Fzen.yandex.ru")>-1||ref==="zen.yandex.ru"){return"yandex_zen"}if(location.search=="?f"){return"facebook_group"}if(ref===""){document.cookie="__io_r=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";return _io_source_for_referrer("direct")}var same_host=ref.indexOf(location.hostname)>0&&ref.indexOf(location.hostname)<10?true:false;var isCanonicalHostname=new RegExp("^(www.)?"+window.location.hostname.replace(/^www\./,"")).test(this.parseURL(ref).hostname);if(isCanonicalHostname)same_host=true;if(defaults.excludeReferrersByDomain!==""){if(new RegExp(defaults.excludeReferrersByDomain+"$").test(this.parseURL(ref).hostname)){same_host=true}}if(!same_host){var _t=new Date;_t.setYear(_t.getFullYear()+1);document.cookie="__io_r="+ref+"; expires="+_t.toUTCString()+"; path=/"}if(same_host){var _io_cookie_match_r=document.cookie.match(/__io_r=([^;]+)/);if(document.cookie.indexOf("__io_r=")!==-1&&_io_cookie_match_r&&_io_cookie_match_r.length&&_io_cookie_match_r.length>1){ref=_io_cookie_match_r[1]}else{return _io_source_for_referrer("direct")}}ref=ref.replace("www.","");if(ref.indexOf("/")!==-1)ref=ref.split("/")[2];ref=ref.replace(/\.$/,"");if(ref.indexOf("plus.google.")===-1)ref=ref.replace(/google\.[a-z]+(\.[a-z]+)?/,"google");else ref=ref.replace(/google(\.[a-z]+)?(\.[a-z]+)?/i,"google");if(ref.indexOf("plus.url.google")!==-1)ref="google.plus";ref=ref.replace(/([m|mobile|web|mbasic|touch]\.)?facebook\.com/,"facebook");ref=ref.replace(/facebook/i,"facebook");ref=ref.replace(/fb\.me/,"facebook");ref=ref.replace(/^fb$/,"facebook");ref=ref.replace(/(m\.)?vk\.com/,"vk.com");ref=ref.replace(/vkontakte\.ru/,"vk.com");ref=ref.replace(/^vk$/,"vk.com");ref=ref.replace(/([a-z_]+).vk.com/,"vk.com");ref=ref.replace(/^t\.co/,"twitter");ref=ref.replace(/clck\.yandex\.ru/,"yandex.ru");ref=ref.replace(/yandex\.[a-z]+(\.[a-z]+)?/,"yandex.ru");ref=ref.replace(/m\.ok\.ru/,"ok.ru");ref=ref.replace(/l\.facebook/,"facebook");ref=ref.replace(/lfacebook/,"facebook");ref=ref.replace(/mobifacebook/,"facebook");ref=ref.replace(/wefacebook/,"facebook");ref=ref.replace(/twitter.com/,"twitter");ref=ref.replace(/com.google/,"google");ref=ref.replace(/Google/,"google");ref=ref.replace(/([a-z_]+).yahoo.com/,"yahoo.com");ref=ref.replace(/([a-z_]+).bing.com/,"bing.com");ref=ref.replace(/([a-z_]+).baidu.com/,"baidu.com");ref=ref.replace(/m\.news\.yandex/,"news.yandex");ref=ref.replace(/googleads\.g\.doubleclick\.net/,"doubleclick.net");ref=ref.replace(/(.*)\.directadvert\.ru/,"directadvert.ru");if(ref.indexOf("news")!==-1&&ref.indexOf("yandex")!==-1)ref="news.yandex.ru";ref=ref.replace(/duckduckgo\.com/i,"duckduckgo");ref=ref.replace(/ecosia\.org/i,"ecosia");ref=ref.replace(/[:,]/g,"_");return ref};exports.getDeviceName=function(){if(!navigator.userAgent){navigator.userAgent="undefined"}var device="desktop";var is_mobile=/Android|webOS|iPhone|PlayBook|iPad|iPod|IEMobile|BlackBerry|Mobile|Opera Mini/i.test(navigator.userAgent);var is_tablet=/Tablet|PlayBook|iPad/i.test(navigator.userAgent)||/Android/i.test(navigator.userAgent)&&!/Mobile/i.test(navigator.userAgent)&&!/Opera Mini/i.test(navigator.userAgent);var is_android=/Android/i.test(navigator.userAgent);var is_ios=/iPhone|iPad|iPod/i.test(navigator.userAgent);if(is_mobile){if(is_tablet){device="tablet";if(is_android)device+="%20(Android)";else if(is_ios)device+="%20(iOS)";else device+="%20(Other)"}else{device="smart";if(is_android)device+="%20(Android)";else if(is_ios)device+="%20(iOS)";else device+="%20(Other)"}}return device};exports.getBrowserNameAndVersion=function(){try{if(!navigator.userAgent){navigator.userAgent="undefined"}var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return"IE "+(tem[1]||"")}if(M[1]==="Chrome"){tem=ua.match(/\b(OPR|Edge)\/(\d+)/);if(tem!=null)return tem.slice(1).join(" ").replace("OPR","Opera")}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!=null)M.splice(1,1,tem[1]);return M.join(" ")}catch(e){}};exports.getUserLifeTime=function(){var tl=document.cookie.match(/__io=([^;]+)/);if(!tl)return"0";else tl=tl[1].split("_")[1];tl=Math.round((+Date.now()-tl)/(60*60*24*1e3));if(tl<0)tl=0;if(tl==0)tl="0";else if(tl<7)tl+="d";else if(tl<30)tl=Math.round(tl/7)+"w";else tl=Math.round(tl/30)+"m";return tl};exports.getUserLifeTimeNumber=function(){var tl=document.cookie.match(/__io_lv=([^;]+)/);if(!tl)return"0";else tl=tl[1];tl=Math.round((+Date.now()-tl)/(60*60*24*1e3));return tl};exports.getUserType=function(){var user_type="";if(document.cookie.indexOf("__io=")==-1){var _t=new Date;_t.setYear(_t.getFullYear()+1);var _tv=Math.floor((1+Math.random())*68719476736).toString(16).substring(1)+"."+Math.floor((1+Math.random())*68719476736).toString(16).substring(1);document.cookie="__io="+_tv+"_"+ +Date.now()+"; expires="+_t.toUTCString()+"; path=/"}else{var _t=new Date;_t.setYear(_t.getFullYear()+1);document.cookie="__io="+(typeof this.getCookieValue("__io")!="undefined"?this.getCookieValue("__io")+"; expires="+_t.toUTCString()+"; path=/":"")}if(document.cookie.indexOf("__io_lv=")==-1){user_type="new";var _t=new Date;_t.setYear(_t.getFullYear()+1);document.cookie="__io_lv="+ +Date.now()+"; expires="+_t.toUTCString()+"; path=/"}else{if(this.getUserLifeTime()==0){user_type="new"}else{var _last_visit=this.getUserLifeTimeNumber()*1;if(_last_visit>30)user_type="new";else if(_last_visit>7)user_type="returned";else user_type="constant";var _t=new Date;_t.setYear(_t.getFullYear()+1);document.cookie="__io_lv="+ +Date.now()+"; expires="+_t.toUTCString()+"; path=/"}}return user_type};exports.getBrowserName=function(){if(!navigator.userAgent){navigator.userAgent="undefined"}var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return"IE"}if(M[1]==="Chrome"){tem=ua.match(/\b(Edge)\/(\d+)/);if(tem!=null)return"Edge"}if(M[1]==="Chrome"){tem=ua.match(/\b(OPR)\/(\d+)/);if(tem!=null)return"Opera"}if(M[1]==="Chrome"){tem=ua.match(/\b(YaBrowser)\/(\d+)/);if(tem!=null)return"YaBrowser"}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!=null)M.splice(1,1,tem[1]);M[0]=M[0].replace(/[0-9\s]+$/g,"");if(M[0]=="MSIE")M[0]="IE";var t=document.title||"none";return M[0]};exports.getBrowserName=function(){if(!navigator.userAgent){navigator.userAgent="undefined"}var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return"IE"}if(M[1]==="Chrome"){tem=ua.match(/\b(Edge)\/(\d+)/);if(tem!=null)return"Edge"}if(M[1]==="Chrome"){tem=ua.match(/\b(OPR)\/(\d+)/);if(tem!=null)return"Opera"}if(M[1]==="Chrome"){tem=ua.match(/\b(YaBrowser)\/(\d+)/);if(tem!=null)return"YaBrowser"}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!=null)M.splice(1,1,tem[1]);M[0]=M[0].replace(/[0-9\s]+$/g,"");if(M[0]=="MSIE")M[0]="IE";var t=document.title||"none";return M[0]};exports.getBrowserName=function(){if(!navigator.userAgent){navigator.userAgent="undefined"}var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return"IE"}if(M[1]==="Chrome"){tem=ua.match(/\b(Edge)\/(\d+)/);if(tem!=null)return"Edge"}if(M[1]==="Chrome"){tem=ua.match(/\b(OPR)\/(\d+)/);if(tem!=null)return"Opera"}if(M[1]==="Chrome"){tem=ua.match(/\b(YaBrowser)\/(\d+)/);if(tem!=null)return"YaBrowser"}M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"];if((tem=ua.match(/version\/(\d+)/i))!=null)M.splice(1,1,tem[1]);M[0]=M[0].replace(/[0-9\s]+$/g,"");if(M[0]=="MSIE")M[0]="IE";var t=document.title||"none";return M[0]};exports.getReferenceTimeFromWordsCount=function(wordsCount){return Math.round(wordsCount/(190/60))};exports.getReferenceTimeFromBlock=function(selector){var sym_block_text=selector instanceof Node?selector:document.querySelector(selector);if(sym_block_text){var clone_sym_block_text=sym_block_text.cloneNode(true);var levak=clone_sym_block_text.querySelectorAll("script, style, noscript, video");for(var i=0;i<levak.length;i++){if(levak[i].remove){levak[i].remove()}else{levak[i].parentNode.removeChild(levak[i])}}var text=clone_sym_block_text.textContent.trim().replace(/[,:;()\/&+]|\-\-/g," ").replace(/[\.!?]/g,".").replace(/^\s+/,"").replace(/[ ]*(\n|\r\n|\r)[ ]*/g,".").replace(/([\.])[\.]+/g,".").replace(/[ ]*([\.])/g,". ").replace(/\s+/g," ").replace(/\s+$/,"").replace(/\n /,"\n");var wordsCount=text.split(" ").length||1;return this.getReferenceTimeFromWordsCount(wordsCount)}};exports.trackMetricsSentAsMessages=function(metricsNames){function isEventFromAnIFrame(event){var iframes=document.getElementsByTagName("iframe");var i;for(i=0;i<iframes.length;i++){if(iframes[i].contentWindow!==event.source)continue;return true}return false}function processAnEvent(event){if(!event||typeof event!=="object"||!event.data||!event.source)return;if(!isEventFromAnIFrame(event))return;var data=this.parseJSONSafe(event.data);if(!data||typeof data!=="object"||data.event!=="ioMetricSent"||!data.info||metricsNames.indexOf(data.info.name)===-1)return;data.info.slices.domain=window.location.hostname;data.info.slices.page=document.title;data.info.slices.depth=this.getDepth();this.sendMetric(data.info.name,data.info.slices)}this.addEventListenerSafe(window,"message",processAnEvent.bind(this))};exports.getSortedSemver=function(arrayWithVersions){return arrayWithVersions.sort(function(a,b){var i,diff;var regExStrip0=/(\.0+)+$/;var segmentsA=a.replace(regExStrip0,"").split(".");var segmentsB=b.replace(regExStrip0,"").split(".");var l=Math.min(segmentsA.length,segmentsB.length);for(i=0;i<l;i++){diff=parseInt(segmentsA[i],10)-parseInt(segmentsB[i],10);if(diff)return diff}return segmentsA.length-segmentsB.length})};exports.injectScriptBySrc=function(src,id){var firstScript=document.getElementsByTagName("script")[0];var script=document.createElement("script");script.id=id;script.async=true;script.src=src;firstScript.parentNode.insertBefore(script,firstScript)};exports.loadComponentAsync=function(component){window.setTimeout(function(){try{component.init()}catch(error){this.trackErrorMetric(error)}}.bind(this),0)};return exports}(window,document,IO.defaults);if(typeof IO=="undefined")var IO={};IO.rawCodeLoader=function exportRawCodeLoader(window,defaults,helpers){var exports={};exports.init=function(){if(document.cookie.indexOf("__io_raw=1")===-1)return;if(document.getElementById("io-rawjs"))return;window.IO=void 0;helpers.injectScriptBySrc("https://platform.onthe.io/raw.js/"+defaults.projectCodeId,"io-rawjs");return true};return exports}(window,IO.defaults,IO.helpers);if(typeof IO=="undefined")var IO={};IO.eventAPI=function exportEventAPI(window,document,helpers,transformEventHook){var exports={};exports.mergeIdenticalCartItems=function(cart){var filteredCart=[];var filteredCartMap={};var productHash;var i;for(i=0;i<cart.length;i++){productHash=String(cart[i].product_id)+String(cart[i].coins_int||cart[i].price);if(filteredCartMap.hasOwnProperty(productHash)){filteredCartMap[productHash].count+=cart[i].count}else{filteredCartMap[productHash]=cart[i]}}for(var key in filteredCartMap){if(filteredCartMap.hasOwnProperty(key)){filteredCart.push(filteredCartMap[key])}}return filteredCart};exports.saveBasketItems=function(id,count){if(!helpers.getStorageStatus())return;var items=helpers.parseJSONSafe(window.localStorage.getItem("__io_add_to_busket"))||{};items[id]=window.parseInt(count,10)+(items[id]||0);window.localStorage.setItem("__io_add_to_busket",JSON.stringify(items))};exports.getAvailableBasketItemsCount=function(id,absoluteCount){if(!helpers.getStorageStatus())return count;var items=helpers.parseJSONSafe(window.localStorage.getItem("__io_add_to_busket"))||{};var count=window.parseInt(absoluteCount,10)-(items[id]||0);return count<=0?0:count};exports.getTryOrderSendCount=function(id,count){if(!helpers.getStorageStatus())return count;var sentOrderTrys=helpers.parseJSONSafe(window.localStorage.getItem("__io_order_try"))||{};var sentCountForCurrentId=sentOrderTrys[id]||0;if(sentCountForCurrentId>=count)return 0;var availableCount=count-sentCountForCurrentId;sentOrderTrys[id]=sentCountForCurrentId+availableCount;window.localStorage.setItem("__io_order_try",JSON.stringify(sentOrderTrys));return availableCount};exports.saveBusketSendAction=function(id){if(!helpers.getStorageStatus())return;window.localStorage.removeItem("__io_order_try");window.localStorage.removeItem("__io_add_to_busket");var completedOrders=helpers.parseJSONSafe(window.localStorage.getItem("__io_order_complete"))||[];if(completedOrders.indexOf(id)!==-1)return;completedOrders.push(id);window.localStorage.setItem("__io_order_complete",JSON.stringify(completedOrders));return true};exports.addDefaultSlices=function(slices){slices.user_id=helpers.getUserId();slices.browser=helpers.getBrowserName();slices.referrer=helpers.getReferrer();slices.device=helpers.getDeviceName();slices.lifetime=helpers.getUserLifeTimeNumber();slices.browser_version=helpers.getBrowserNameAndVersion();slices.user_type=helpers.getUserType();this._io_push_utm_data(slices);this._io_push_atom(slices)};exports.parseAndSendEventAsMetric=function(event,parametersToMergeIn){var metric={name:null,slices:{},repeatCount:1};var entityName;var entityValue;var allowedCategoriesMap=["category","sub_category","sub_sub_category","extra_category"];var eventNameMap={order:"try_order_send",checkout:"basket_send",send_user_data:"user_data",search:"search_queries"};var i;var parameter;for(parameter in parametersToMergeIn){if(!parametersToMergeIn.hasOwnProperty(parameter))continue;if(event.hasOwnProperty(parameter))continue;event[parameter]=parametersToMergeIn[parameter]}for(entityName in event){if(!event.hasOwnProperty(entityName))continue;entityValue=event[entityName];if(helpers.identifyArray(entityValue)){if(!entityValue.join("").trim())continue}else if(typeof entityValue!=="object"||entityValue==null){entityValue=String(entityValue).trim();if(!entityValue)continue}switch(entityName){case"count":metric.repeatCount=entityValue;break;case"product_url":metric.slices.url=helpers.parseURL(entityValue).pathname;break;case"categories":for(i=0;i<entityValue.length;i++){if(allowedCategoriesMap[i]){metric.slices[allowedCategoriesMap[i]]=entityValue[i]}}break;case"price":metric.slices.coins_int=entityValue;break;case"event":metric.slices.event=entityValue;metric.name=eventNameMap[entityValue]||entityValue;break;case"product_id":metric.slices.product_id=entityValue;metric.slices.post_uid=entityValue;break;case"order_id":metric.slices.order_id=entityValue;metric.slices.label=entityValue;break;case"error_field":metric.slices.error="Ошибка в поле "+(entityValue.name||entityValue);break;case"search_query":metric.slices.search_queries=entityValue;break;case"search_results":metric.slices.time_int=entityValue;break;default:if(metric.slices.hasOwnProperty(entityName))continue;metric.slices[entityName]=entityValue;break}}if(event.cart){event.cart=this.mergeIdenticalCartItems(event.cart);metric.slices.cart="";for(i=0;i<event.cart.length;i++){event.cart[i].event=event.event;this.parseAndSendEventAsMetric(event.cart[i],metric.slices)}return}if(event.errors){metric.slices.errors="";for(i=0;i<event.errors.length;i++){this.parseAndSendEventAsMetric(event.errors[i],metric.slices)}return}if(event.event==="search"){if(event.search_results===0){this.parseAndSendEventAsMetric({event:"search_null_items"},metric.slices)}else{this.parseAndSendEventAsMetric({event:"search_items"},metric.slices)}}if(metric.name==="add_to_basket"){this.saveBasketItems(helpers.hashFnv32a(metric.slices.product_id+metric.slices.coins_int),metric.repeatCount)}if(metric.name==="try_order_send"){var addToBusketSlices=helpers.cloneObjectShallow(metric.slices);addToBusketSlices.count=this.getAvailableBasketItemsCount(helpers.hashFnv32a(metric.slices.product_id+metric.slices.coins_int),metric.repeatCount);if(addToBusketSlices.count){this.parseAndSendEventAsMetric({event:"add_to_basket"},addToBusketSlices)}metric.repeatCount=this.getTryOrderSendCount(helpers.hashFnv32a(metric.slices.product_id+metric.slices.coins_int),metric.repeatCount);if(!metric.repeatCount)return}if(metric.name==="basket_send"){if(!this.saveBusketSendAction(helpers.hashFnv32a(metric.slices.order_id+metric.slices.product_id+metric.slices.coins_int)))return}this.addDefaultSlices(metric.slices);helpers.sendMetric(metric.name,metric.slices,metric.repeatCount)};exports._io_push_utm_data=function(slices){var pars=[];var pc=[];var utm=[];function _io_setCookie(name,value,expires,path,domain){var date=new Date;date.setTime(date.getTime()+24*60*60*1e3);expires=expires||date.toGMTString();domain=domain||location.host.indexOf("www.")&&location.host||location.host.replace("www.","");path=path||"/";document.cookie=name+"="+escape(value)+(expires?"; expires="+expires:"")+(path?"; path="+path:"")+"; domain=."+domain}function _io_same_host(){var ref=typeof _io_referrer_value=="undefined"?document.referrer:_io_referrer_value;var same_host=ref.indexOf(location.hostname)>0&&ref.indexOf(location.hostname)<10?true:false;return same_host}function _io_referrer_group(ref){ref=ref.replace("www.","");if(ref.indexOf("/")!==-1)ref=ref.split("/")[2];ref=ref.replace(/\.$/,"");if(ref.indexOf("plus.google.")===-1)ref=ref.replace(/google\.[a-z]+(\.[a-z]+)?/,"google");else ref=ref.replace(/google(\.[a-z]+)?(\.[a-z]+)?/i,"google");if(ref.indexOf("plus.url.google")!==-1)ref="google.plus";ref=ref.replace(/([m|mobile|web|mbasic|touch]\.)?facebook\.com/,"facebook");ref=ref.replace(/facebook/i,"facebook");ref=ref.replace(/fb\.me/,"facebook");ref=ref.replace(/^fb$/,"facebook");ref=ref.replace(/(m\.)?vk\.com/,"vk.com");ref=ref.replace(/vkontakte\.ru/,"vk.com");ref=ref.replace(/^vk$/,"vk.com");ref=ref.replace(/([a-z_]+).vk.com/,"vk.com");ref=ref.replace(/^t\.co/,"twitter");ref=ref.replace(/clck\.yandex\.ru/,"yandex.ru");ref=ref.replace(/yandex\.[a-z]+(\.[a-z]+)?/,"yandex.ru");ref=ref.replace(/m\.ok\.ru/,"ok.ru");ref=ref.replace(/l\.facebook/,"facebook");ref=ref.replace(/lfacebook/,"facebook");ref=ref.replace(/mobifacebook/,"facebook");ref=ref.replace(/wefacebook/,"facebook");ref=ref.replace(/twitter.com/,"twitter");ref=ref.replace(/com.google/,"google");ref=ref.replace(/Google/,"google");ref=ref.replace(/([a-z_]+).yahoo.com/,"yahoo.com");ref=ref.replace(/([a-z_]+).bing.com/,"bing.com");ref=ref.replace(/([a-z_]+).baidu.com/,"baidu.com");ref=ref.replace(/m\.news\.yandex/,"news.yandex");ref=ref.replace(/googleads\.g\.doubleclick\.net/,"doubleclick.net");ref=ref.replace(/(.*)\.directadvert\.ru/,"directadvert.ru");if(ref.indexOf("news")!==-1&&ref.indexOf("yandex")!==-1)ref="news.yandex.ru";ref=ref.replace(/duckduckgo\.com/i,"duckduckgo");ref=ref.replace(/ecosia\.org/i,"ecosia");return encodeURIComponent(ref.replace(/[:,]/g,"_"))}if(location.search)pars=location.search.substr(1).split(/&/);for(var i=0;i<pars.length;i++){var p=pars[i].split("=");if(p[0].indexOf("utm_")==0&&p[0].substr(4).match(/^[a-z]+$/)){pc.push(pars[i]);var v=p[1];if(p[0].substr(4)==="source"){if(document.cookie.indexOf("__io_fs=")==-1){slices.first_source=v;var _t=new Date;_t.setYear(_t.getFullYear()+1);document.cookie="__io_fs="+v+"; expires="+_t.toUTCString()+"; path=/"}else{var fs=document.cookie.match(/__io_fs=([^;]+)/)?document.cookie.match(/__io_fs=([^;]+)/)[1]:false;if(fs)slices.first_source=fs}}if(p[0].substr(4)==="referrer"){v=_io_referrer_group(decodeURIComponent(v))}if(p[0].substr(4)!="campaig"){utm.push(p[0].substr(4)+":"+v);slices[p[0].substr(4)]=v}}}if(utm.length>0){utm=utm.join("|||");var _t=new Date;_t.setYear(_t.getFullYear()+1);document.cookie="__io_utm="+utm+"; expires="+_t.toUTCString()+"; path=/"}else if(!_io_same_host()){document.cookie="__io_utm=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}else{if(document.cookie.indexOf("__io_utm=")!==-1){utm=document.cookie.match(/__io_utm=([^;]+)/);utm=utm[1].split("|||");for(var i=0;i<utm.length;i++){var utm_tag=utm[i].split(":");slices[utm_tag[0]]=utm_tag[1]}if(document.cookie.indexOf("__io_fs=")!==-1){var fs=document.cookie.match(/__io_fs=([^;]+)/)?document.cookie.match(/__io_fs=([^;]+)/)[1]:false;if(fs)slices.first_source=fs}}}};exports._io_push_atom=function(slices){function _io_same_host(){var ref=typeof _io_referrer_value=="undefined"?document.referrer:_io_referrer_value;var same_host=ref.indexOf(location.hostname)>0&&ref.indexOf(location.hostname)<10?true:false;return same_host}function _io_setCookie(name,value,expires,path,domain){var date=new Date;date.setTime(date.getTime()+24*60*60*1e3);expires=expires||date.toGMTString();domain=domain||location.host.indexOf("www.")&&location.host||location.host.replace("www.","");path=path||"/";document.cookie=name+"="+escape(value)+(expires?"; expires="+expires:"")+(path?"; path="+path:"")+"; domain=."+domain}var prev_io_utm=helpers.getCookieValue("__io_atom");if(!_io_same_host()){_io_setCookie("__io_source","",-1);_io_setCookie("__io_atom","",-1)}var io_utm=helpers.getSearchParam("io_utm");var io_source=helpers.getSearchParam("io_source");if(io_utm){var date=new Date;date.setYear(date.getFullYear()+1);_io_setCookie("__io_atom",io_utm,date);_io_setCookie("__io_source",io_source,date)}else{io_utm=helpers.getCookieValue("__io_atom");io_source=helpers.getCookieValue("__io_source")}if(io_utm){slices.io_utm=io_utm;if(io_source){slices.io_source=io_source}}if(io_utm&&prev_io_utm!=io_utm){document.cookie="__io_visit_pageviews=1; expires="+new Date((new Date).getTime()+15*60*1e3).toUTCString()+"; path=/";window._io_data.push({event:"visits_pageviews"})}};exports.init=function(){helpers.setIntervalSafe(window,function(){if(!IO.helpers.getDeepPropertySafe(window,["_io_data","length"]))return;var event=window._io_data.pop();if(typeof transformEventHook==="function"){transformEventHook(event)}if(helpers.getDeepPropertySafe(event,["event"])){this.parseAndSendEventAsMetric(event)}}.bind(this),10)};return exports}(window,document,IO.helpers,typeof _io_on_event_prepare!=="undefined"?_io_on_event_prepare:null);if(typeof IO=="undefined")var IO={};IO.configParser=function exportConfigParser(window,document,helpers){var exports={};exports.appendDefaultSlices=function(slices,blockURI,pageURI){if(window.navigator.userAgent){slices.user_agent=window.navigator.userAgent}var previousPagePathname=helpers.getPreviousPageRelativeURI(pageURI);if(previousPagePathname){if(previousPagePathname==="/"){slices.previous_page="Main Page"}else{slices.pr=previousPagePathname}}if(helpers.decodeURIrecursively(slices.url)!==helpers.decodeURIrecursively(window.location.pathname)){slices.url_real=window.location.pathname}slices.device=helpers.getDeviceName();slices.browser_version=helpers.getBrowserNameAndVersion();slices.browser=helpers.getBrowserName();slices.referrer=helpers.getReferrer();slices.depth=helpers.getDepth();slices.user_type=helpers.getUserType();if(!slices.reference_time){var referenceTime=helpers.getReferenceTimeFromBlock('[data-io-article-url="'+blockURI+'"]');if(referenceTime){slices.reference_time=referenceTime}}};exports.getSlicesFromPageDescriptor=function(descriptor){var slices={};var entityName;var entityValue;var tmpTransformedEntityValue;for(entityName in descriptor){if(!descriptor.hasOwnProperty(entityName))continue;entityValue=descriptor[entityName];if(!entityValue){continue}else if(helpers.identifyArray(entityValue)){entityValue=entityValue.join("|").trim()}else{entityValue=String(entityValue).trim()}if(!entityValue)continue;switch(entityName){case"page_url":tmpTransformedEntityValue=helpers.parseURL(entityValue);slices.domain=tmpTransformedEntityValue.hostname;slices.url=tmpTransformedEntityValue.pathname;break;case"page_url_canonical":tmpTransformedEntityValue=helpers.parseURL(entityValue);slices.domain=tmpTransformedEntityValue.hostname;slices.url=tmpTransformedEntityValue.pathname+tmpTransformedEntityValue.search;break;case"page_title":slices.page=entityValue;break;case"page_type":if(entityValue==="article"&&!slices.author){slices.author="No Author"}break;case"page_language":slices.language=entityValue;break;case"article_authors":if(descriptor.page_type==="article"){slices.author=entityValue}break;case"article_categories":slices.category=entityValue;break;case"article_subcategories":slices.sub_category=entityValue;break;case"article_type":slices.type_article=entityValue;break;case"article_word_count":slices.reference_time=helpers.getReferenceTimeFromWordsCount(entityValue);break;default:slices[entityName]=entityValue;break}}return slices};exports.getLatestConfig=function(){if(String(window._io_config)!=="[object Object]")return;var latestVersion=helpers.getSortedSemver(helpers.getEnumerableKeys(window._io_config)).pop();return window._io_config[latestVersion]};var PageDescriptor={};PageDescriptor.init=function(descriptior){this.data=descriptior;return this};PageDescriptor.testForRequiredFields=function(){if(PageDescriptor.errorTrackedOnce)return true;var errors=[];var requiredEntitiesNames=["page_url","page_title","page_type","page_language"];var i;for(i=0;i<requiredEntitiesNames.length;i++){if(!this.data[requiredEntitiesNames[i]]){errors.push(requiredEntitiesNames[i]+" config entity is required")}}if(errors.length===0)return;helpers.trackErrorMetric("Config Validation Errors: "+errors.join(", "),"error_config");PageDescriptor.errorTrackedOnce=true;return errors};PageDescriptor.getSlices=function(){var slices=exports.getSlicesFromPageDescriptor(this.data);exports.appendDefaultSlices(slices,this.data.page_url,slices.url);return slices};exports.PageDescriptor=PageDescriptor;exports.getPageDescriptor=function(url){var latestConfig=this.getLatestConfig();if(!latestConfig)return;var pathnameToMatch=url?helpers.parseURL(url).pathname:window.location.pathname;pathnameToMatch=helpers.decodeURIrecursively(pathnameToMatch);var interationEntity;var interationPathname;for(var i=latestConfig.length;i--;){interationEntity=latestConfig[i];if(!interationEntity.page_url)continue;interationPathname=helpers.parseURL(interationEntity.page_url).pathname;interationPathname=helpers.decodeURIrecursively(interationPathname);if(interationPathname===pathnameToMatch){return helpers.createObject(PageDescriptor).init(interationEntity)}}};exports.bindOnPageDescriptorAppearance=function(url,callback){var interval=helpers.setIntervalSafe(window,function(){var descriptor=this.getPageDescriptor(url);if(!descriptor)return;if(descriptor.testForRequiredFields())return;window.clearInterval(interval);callback(descriptor)}.bind(this),10)};return exports}(window,document,IO.helpers);if(typeof IO=="undefined")var IO={};IO.uniqueTracker=function exportUniqueTracker(window,defaults,helpers,configParser){var exports={};exports.init=function(){configParser.bindOnPageDescriptorAppearance(window.location.href,function(pageDescriptor){var cookieName="__io_unique";var _io_unique_var=document.cookie.match(new RegExp(cookieName+"=([^;]+)"));if(!(document.cookie.indexOf(cookieName+"=")==-1||_io_unique_var&&_io_unique_var[1]&&_io_unique_var[1]!=(new Date).getDate())){return}var date1year=new Date((new Date).setYear((new Date).getFullYear()+1)).toUTCString();var cookie=cookieName+"="+(new Date).getDate()+"; expires="+date1year+"; path=/";if(window.parseInt(defaults.projectUniquesBySuperdomain,10)){cookie+=";domain=."+window.location.hostname.replace(/^www\./,"")}document.cookie=cookie;helpers.sendMetric("uniques_instantly",pageDescriptor.getSlices())})};return exports}(window,IO.defaults,IO.helpers,IO.configParser);if(typeof IO=="undefined")var IO={};IO.holdingUniqueTracker=function exportHoldingUniqueTracker(window,defaults,helpers){var exports={};exports.setStateCookie=function(cookieName){var endOfTheDay=new Date((new Date).setHours(24,0,0,0)).toUTCString();var cookie=cookieName+"=1; expires="+endOfTheDay+"; path=/";if(window.parseInt(defaults.projectUniquesBySuperdomain,10)){cookie+=";domain=."+window.location.hostname.replace(/^www\./,"")}document.cookie=cookie};exports.sendHoldingMetric=function(hashFront){var request=new Image;request.src="https://"+defaults.trackingHost+"/?k[]="+defaults.holdingId+":uniques_holding"+"&s="+defaults.projectSignature+"&__io="+(hashFront||helpers.getUserId())+"&"+Date.now()};exports.init=function(){if(!defaults.holdingHash||!defaults.holdingId)return;if(document.cookie.indexOf("__io_uh")!==-1)return;this.setStateCookie("__io_uh");if(document.getElementById("io-holdingjs"))return;var src="https://"+defaults.trackingHost+"/uniques/?current="+(new Date).getDate()+"&holding="+defaults.holdingHash+"&hash_user="+helpers.getUserId()+"&"+Date.now();helpers.injectScriptBySrc(src,"io-holdingjs");var interval=helpers.setIntervalSafe(window,function checkIfVariableIsAvailable(){if(typeof window._io_uniques_holing_params==="undefined")return;window.clearInterval(interval);if(window._io_uniques_holing_params==="track")return this.sendHoldingMetric();var day=window._io_uniques_holing_params.match(new RegExp("(?:^|; )"+("io_uid"+defaults.holdingHash).replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));var hash_user_front=window._io_uniques_holing_params.match(new RegExp("(?:^|; )"+"io_user_hash".replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));if(day&&day[1]&&day[1]!=(new Date).getDate()||!day){this.sendHoldingMetric(hash_user_front[1])}}.bind(this),250)};return exports}(window,IO.defaults,IO.helpers);if(typeof IO=="undefined")var IO={};IO.visitTracker=function exportVisitTracker(window,helpers,defaults,configParser){var exports={};exports.init=function(){configParser.bindOnPageDescriptorAppearance(window.location.href,function(pageDescriptor){if(document.cookie.indexOf("__io_visit")!==-1)return;var cookie="__io_visit=1; expires="+new Date((new Date).getTime()+15*60*1e3).toUTCString()+";  path=/";if(window.parseInt(defaults.projectVisitsBySuperdomain,10)){cookie+=";domain=."+window.location.hostname.replace(/^www\./,"")}document.cookie=cookie;helpers.sendMetric("visits_instantly",pageDescriptor.getSlices(),null,true)})};return exports}(window,IO.helpers,IO.defaults,IO.configParser);if(typeof IO=="undefined")var IO={};IO.viewTracker=function exportViewTracker(window,helpers,configParser){var exports={};exports.listenForConfigAndPageMatchOnce=function(){configParser.bindOnPageDescriptorAppearance(window.location.href,function(pageDescriptor){var slices=pageDescriptor.getSlices();helpers.sendMetric("pageviews",slices)}.bind(this))};exports.listenForPageChnages=function(){helpers.bindOnUrlChange(this.listenForConfigAndPageMatchOnce.bind(this))};exports.init=function(){this.listenForConfigAndPageMatchOnce();this.listenForPageChnages()};return exports}(window,IO.helpers,IO.configParser);if(typeof IO=="undefined")var IO={};IO.readabilityTracker=function exportReadabilityTracker(window,document,helpers,configParser){var exports={};var ArticleToRead={};ArticleToRead.setTimestampStart=function(){this.timestampStart=(new Date).getTime()};ArticleToRead.setTimestampFinish=function(){this.timestampFinish=(new Date).getTime()};ArticleToRead.getScrollPercent=function(){var articleHeight=this.element.getBoundingClientRect().bottom-this.element.getBoundingClientRect().top;var abs=(window.innerHeight-this.element.getBoundingClientRect().bottom)/articleHeight;var top=abs>0?0:abs<-1?-1:abs;top=100-Math.abs(Math.floor(top*100));return Math.abs(top)};ArticleToRead.tryToTrackReadabilityAndUnbind25=function(){this.setTimestampStart();if(this.getScrollPercent()<=25)return;document.removeEventListener("scroll",this.boundHandles.tryToTrackReadabilityAndUnbind25);configParser.bindOnPageDescriptorAppearance(this.url,function(descriptor){helpers.sendMetric("read_top",descriptor.getSlices())})};ArticleToRead.tryToTrackReadabilityAndUnbind50=function(){if(this.getScrollPercent()<=50)return;document.removeEventListener("scroll",this.boundHandles.tryToTrackReadabilityAndUnbind50);configParser.bindOnPageDescriptorAppearance(this.url,function(descriptor){helpers.sendMetric("read_middle",descriptor.getSlices())})};ArticleToRead.tryToTrackReadabilityAndUnbind75=function(){if(this.getScrollPercent()<=75)return;document.removeEventListener("scroll",this.boundHandles.tryToTrackReadabilityAndUnbind75);configParser.bindOnPageDescriptorAppearance(this.url,function(descriptor){helpers.sendMetric("read_bottom",descriptor.getSlices())})};ArticleToRead.tryToTrackReadabilityAndUnbind95=function(){if(this.getScrollPercent()<=95)return;document.removeEventListener("scroll",this.boundHandles.tryToTrackReadabilityAndUnbind95);this.setTimestampFinish();configParser.bindOnPageDescriptorAppearance(this.url,function(descriptor){var slices=descriptor.getSlices();slices.time_int=Math.round((this.timestampFinish-this.timestampStart)/1e3);helpers.sendMetric("read_finished",slices)}.bind(this))};ArticleToRead.bindEvents=function(){this.boundHandles={};this.boundHandles.tryToTrackReadabilityAndUnbind25=helpers.addEventListenerSafe(document,"scroll",this.tryToTrackReadabilityAndUnbind25.bind(this));this.boundHandles.tryToTrackReadabilityAndUnbind50=helpers.addEventListenerSafe(document,"scroll",this.tryToTrackReadabilityAndUnbind50.bind(this));this.boundHandles.tryToTrackReadabilityAndUnbind75=helpers.addEventListenerSafe(document,"scroll",this.tryToTrackReadabilityAndUnbind75.bind(this));this.boundHandles.tryToTrackReadabilityAndUnbind95=helpers.addEventListenerSafe(document,"scroll",this.tryToTrackReadabilityAndUnbind95.bind(this))};ArticleToRead.init=function(element){this.element=element;this.setTimestampStart();this.url=element.getAttribute("data-io-article-url");this.bindEvents()};var ArticleReadabilityTracker={};ArticleReadabilityTracker.trackExistingArticles=function(){var articles=document.querySelectorAll("[data-io-article-url]");var i,article;for(i=0;i<articles.length;i++){article=helpers.createObject(ArticleToRead);article.init(articles[i]);this.instances.push(article)}};ArticleReadabilityTracker.listenForNewArticles=function(){helpers.bindOnElementInsertion("[data-io-article-url]",function(element){var article=helpers.createObject(ArticleToRead);article.init(element);this.instances.push(article)}.bind(this))};ArticleReadabilityTracker.init=function(){this.instances=this.instances||[];this.trackExistingArticles();this.listenForNewArticles()};exports=ArticleReadabilityTracker;return exports}(window,document,IO.helpers,IO.configParser);if(typeof IO=="undefined")var IO={};IO.timeTracker=function exportTimeTracker(window,document,helpers,configParser){var exports={};exports.init=function(){helpers.setIntervalSafe(window,function(){if(typeof document.hasFocus==="function"&&!document.hasFocus()){return}else if(document.hidden){return}configParser.bindOnPageDescriptorAppearance(window.location.href,function(descriptor){var slices=descriptor.getSlices();if(!slices.url)return;helpers.sendMetric("time",{url:slices.url})})},1e4)};return exports}(window,document,IO.helpers,IO.configParser);if(typeof IO=="undefined")var IO={};IO.videoTracker=function exportvideoTracker(helpers,document,window,configParser){var GenericVideoInstance={sendMetricWithMergedSlices:function(metricName){configParser.bindOnPageDescriptorAppearance(this.instantiationUrl,function(pageDescriptor){var mergedSlices=pageDescriptor.getSlices();var sliceName;for(sliceName in this.slices){if(!this.slices.hasOwnProperty(sliceName))continue;mergedSlices[sliceName]=this.slices[sliceName]}helpers.sendMetric(metricName,mergedSlices)}.bind(this))},trackView:function(){this.sendMetricWithMergedSlices("video_view")},trackStart:function(){this.sendMetricWithMergedSlices("video_started")},trackFinish:function(){this.sendMetricWithMergedSlices("video_watch_finished")},trackLeave:function(){this.sendMetricWithMergedSlices("video_left")},startTimeTracking:function(){var timesTimeMetricWasSent=1;var intervalInMs=5e3;var timeTrackerId=helpers.setIntervalSafe(window,function(){var nextTimestamp=++timesTimeMetricWasSent*intervalInMs/1e3;if(this.slices.reference_time!=0&&nextTimestamp>=this.slices.reference_time){window.clearInterval(timeTrackerId);return}this.sendMetricWithMergedSlices("video_time")}.bind(this),intervalInMs)},setSliceVideoId:function(href){var url=helpers.parseURL(href);this.slices.video_id=url.hostname+url.pathname},instantiate:function(element){this.element=element;this.slices={title:document.title,type:"default",reference_time:0,time_int:0};this.instantiationUrl=window.location.href;this.setSliceVideoId(window.location.href)}};var GenericInFrameVideoInstance=helpers.createObject(GenericVideoInstance);GenericInFrameVideoInstance.instantiateFrame=function(element){this.instantiate(element);if(!this.element.src)return;this.setSliceVideoId(this.element.src)};var GenericTrackerForVideos={trackExistingVideos:function(){var videos=this.containerElement.querySelectorAll(this.elementSelector);var i,video;for(i=0;i<videos.length;i++){video=helpers.createObject(this.instancePrototype);video.elementSelector=this.elementSelector;video.init(videos[i]);this.instances.push(video)}},listenForNewVideos:function(){helpers.bindOnElementInsertion(this.elementSelector,function(element){var video=helpers.createObject(this.instancePrototype);video.elementSelector=this.elementSelector;video.init(element);this.instances.push(video)}.bind(this),this.containerElement)},initializeStructure:function(elementSelector,instancePrototype,containerElement){this.instancePrototype=instancePrototype;this.elementSelector=elementSelector;this.containerElement=containerElement||document;this.instances=this.instances||[]},startTracking:function(){this.trackExistingVideos();this.listenForNewVideos()}};var HTML5VideoInstance=helpers.createObject(GenericVideoInstance);HTML5VideoInstance.bindEvents=function(){this.boundHandles={};this.boundHandles.trackStartAndUnbind=helpers.addEventListenerSafe(this.element,"play",this.trackStartAndUnbind.bind(this));this.boundHandles.trackFinishAndUnbind=helpers.addEventListenerSafe(this.element,"ended",this.trackFinishAndUnbind.bind(this));this.boundHandles.trackLeaveAndUnbind=helpers.addEventListenerSafe(window,"beforeunload",this.trackLeaveAndUnbind.bind(this))};HTML5VideoInstance.trackStartAndUnbind=function(){this.element.removeEventListener("play",this.boundHandles.trackStartAndUnbind);this.setSlicesTime();this.trackStart()};HTML5VideoInstance.trackFinishAndUnbind=function(){this.setSlicesTime();this.trackFinish();this.trackLeave();this.element.removeEventListener("ended",this.boundHandles.trackFinishAndUnbind);window.removeEventListener("beforeunload",this.boundHandles.trackLeaveAndUnbind)};HTML5VideoInstance.trackLeaveAndUnbind=function(){this.setSlicesTime();this.trackLeave();window.removeEventListener("beforeunload",this.boundHandles.trackLeaveAndUnbind)};HTML5VideoInstance.setSlicesIfJwPlayer=function(){var isJwPlayer=typeof jwplayer=="function"&&typeof jwplayer().getContainer=="function"&&typeof jwplayer().getContainer().querySelector=="function"&&jwplayer().getContainer().querySelector(this.elementSelector)==this.element;if(!isJwPlayer)return;this.slices.type="jwplayer";var hasImage=typeof jwplayer().getConfig=="function"&&typeof jwplayer().getConfig()=="object"&&typeof jwplayer().getConfig().image=="string";if(hasImage)this.slices.image=jwplayer().getConfig().image.split("://").pop();if(typeof jwplayer.version!=="string"||jwplayer.version[0]>6)return;hasImage=typeof helpers.getDeepPropertySafe(jwplayer(),["config","image"])==="string";if(hasImage)this.slices.image=jwplayer().config.image.split("://").pop()};HTML5VideoInstance.setSlicesTime=function(){this.slices.reference_time=this.element.readyState?this.element.duration:0;this.slices.time_int=this.element.readyState?this.element.currentTime:0};HTML5VideoInstance.findAndSetSliceURL=function(){var customSource=this.element.getAttribute("data-io-video-src");var id;if(customSource){id=customSource}else if(this.element.src){id=this.element.src}if(!id)return;if(id.indexOf("blob:")===0){id=id.substring(5)}this.setSliceVideoId(id)};HTML5VideoInstance.setImage=function(){var image=this.element.poster;if(!image)return;this.slices.image=image.split("://").pop()};HTML5VideoInstance.setTitle=function(){var title=this.element.getAttribute("data-io-video-title");if(!title)return;this.slices.title=title};HTML5VideoInstance.init=function(element){this.instantiate(element);this.slices.type="html5";this.findAndSetSliceURL();this.setSlicesTime();this.setImage();this.setTitle();this.setSlicesIfJwPlayer();this.trackView();this.bindEvents()};var TrackerForHTML5Videos=helpers.createObject(GenericTrackerForVideos);TrackerForHTML5Videos.prepare=function(){this.initializeStructure("video[src], video[data-io-video-src]",HTML5VideoInstance)};TrackerForHTML5Videos.start=function(){this.startTracking()};var TrackerForHTML5VideosInFrames=helpers.createObject(GenericTrackerForVideos);TrackerForHTML5VideosInFrames.prepare=function(){var frames=helpers.getSemeOriginFrames();if(!frames.length)return;this.initializeStructure("video[src], video[data-io-video-src]",HTML5VideoInstance,frames[0].contentDocument)};TrackerForHTML5VideosInFrames.start=function(){if(!this.instances)return;this.startTracking()};var YoutubeVideoInstance=helpers.createObject(GenericInFrameVideoInstance);YoutubeVideoInstance.prepareFrameElement=function(){if(this.element.src.indexOf("enablejsapi=1")!=-1){this.element.dispatchEvent(new Event("ioVideoFrameIsReady"));return}helpers.addEventListenerSafe(this.element,"load",function(){this.element.dispatchEvent(new Event("ioVideoFrameIsReady"))}.bind(this));var baseURI=this.element.src.split("?")[0].split("#")[0];var queryString=this.element.src.split("?")[1];this.element.src=baseURI+"?enablejsapi=1&origin="+window.location.origin+(queryString?"&"+queryString:"")};YoutubeVideoInstance.requestMessages=function(){helpers.messageFrameWindow(this.element,{event:"listening",id:this.youtubeId,channel:"widget"});this.element.removeEventListener("ioVideoFrameIsReady",this.boundHandles.requestMessages)};YoutubeVideoInstance.processMessages=function(event){if(event.origin.indexOf("//www.youtube.com")==-1)return;var data=helpers.parseJSONSafe(event.data)||{};var info=data.info;if(!info)return;if((data.id||info.videoData.video_id)!=this.youtubeId)return;if(info.duration||info.mediaReferenceTime)this.slices.reference_time=info.duration||info.mediaReferenceTime;if(info.currentTime)this.slices.time_int=info.currentTime;if(!info.videoData)return;if(info.videoData.title)this.slices.title=info.videoData.title;if(!this.state.viewed){this.state.viewed=true;this.trackView()}if(!this.state.started&&info.playerState==1){this.state.started=true;this.trackStart()}if(!this.state.finished&&info.currentTime==info.duration){this.state.finished=true;this.trackFinish();this.trackLeave();window.removeEventListener("beforeunload",this.boundHandles.trackLeave);window.removeEventListener("message",this.boundHandles.processMessages)}};YoutubeVideoInstance.bindEvents=function(){this.boundHandles={};this.boundHandles.requestMessages=helpers.addEventListenerSafe(this.element,"ioVideoFrameIsReady",this.requestMessages.bind(this));this.boundHandles.processMessages=helpers.addEventListenerSafe(window,"message",this.processMessages.bind(this));this.boundHandles.trackLeave=helpers.addEventListenerSafe(window,"beforeunload",this.trackLeave.bind(this))};YoutubeVideoInstance.init=function(element){this.instantiateFrame(element);this.state={started:false,finished:false,viewed:false};this.youtubeId=this.element.src.split("?").shift().split("/").pop();this.slices.type="youtube";this.slices.image="img.youtube.com/vi/"+this.youtubeId+"/0.jpg";this.bindEvents();this.prepareFrameElement()};var TrackerForYoutubeVideos=helpers.createObject(GenericTrackerForVideos);TrackerForYoutubeVideos.prepare=function(){this.initializeStructure('iframe[src*="//www.youtube.com/embed"]',YoutubeVideoInstance)};TrackerForYoutubeVideos.start=function(){this.startTracking()};var VimeoVideoInstance=helpers.createObject(GenericInFrameVideoInstance);VimeoVideoInstance.requestMessages=function(){helpers.messageFrameWindow(this.element,{method:"getVideoTitle"});helpers.messageFrameWindow(this.element,{method:"getDuration"});helpers.messageFrameWindow(this.element,{method:"addEventListener",value:"playProgress"});this.element.removeEventListener("ioVideoFrameIsReady",this.boundHandles.requestMessages)};VimeoVideoInstance.prepareFrameElement=function(){if(this.element.src.indexOf("player_id=")!=-1){this.element.dispatchEvent(new Event("ioVideoFrameIsReady"));this.playerId=this.element.src.split("player_id=")[1].split("&")[0].split("#")[0];return}helpers.addEventListenerSafe(this.element,"load",function(){this.element.dispatchEvent(new Event("ioVideoFrameIsReady"))}.bind(this));var baseURI=this.element.src.split("?")[0].split("#")[0];var queryString=this.element.src.split("?")[1];this.playerId=Math.floor(Math.random()*1e10);this.element.src=baseURI+"?player_id="+this.playerId+(queryString?"&"+queryString:"")};VimeoVideoInstance.processMessages=function(event){if(event.origin.indexOf("//player.vimeo.com")==-1)return;var data=helpers.parseJSONSafe(event.data);if(!data||data.player_id!=this.playerId)return;if(data.method==="getVideoTitle"&&data.value){this.slices.title=data.value}if(data.method==="getDuration"&&data.value){this.slices.reference_time=data.value}if(!this.state.viewed&&this.slices.reference_time){this.state.viewed=true;this.trackView()}if(data.event==="playProgress"&&data.data){this.slices.reference_time=data.data.duration||0;this.slices.time_int=data.data.seconds||0;if(!this.state.started){this.state.started=true;this.trackStart()}if(!this.state.finished&&data.data.duration===data.data.seconds){this.state.finished=true;this.trackFinish();this.trackLeave();window.removeEventListener("message",this.boundHandles.processMessages);window.removeEventListener("beforeunload",this.boundHandles.trackLeave)}}};VimeoVideoInstance.bindEvents=function(){this.boundHandles={};this.boundHandles.requestMessages=helpers.addEventListenerSafe(this.element,"ioVideoFrameIsReady",this.requestMessages.bind(this));this.boundHandles.processMessages=helpers.addEventListenerSafe(window,"message",this.processMessages.bind(this));this.boundHandles.trackLeave=helpers.addEventListenerSafe(window,"beforeunload",this.trackLeave.bind(this))};VimeoVideoInstance.setId=function(){var id=helpers.decodeURIrecursively(this.element.src).match(/\/video\/(\d+)/);if(id)this.vimeoId=id.pop()};VimeoVideoInstance.init=function(element){this.instantiateFrame(element);this.setId();if(!this.vimeoId)return;this.slices.type="vimeo";this.slices.image="i.vimeocdn.com/video/"+this.vimeoId+"_480.jpg";this.state={started:false,finished:false,viewed:false};this.bindEvents();this.prepareFrameElement()};var TrackerForVimeoVideos=helpers.createObject(GenericTrackerForVideos);TrackerForVimeoVideos.prepare=function(){this.initializeStructure('iframe[src*="//player.vimeo.com/video"]',VimeoVideoInstance)};TrackerForVimeoVideos.start=function(){this.startTracking()};return{html5:TrackerForHTML5Videos,html5InFrames:TrackerForHTML5VideosInFrames,youtube:TrackerForYoutubeVideos,vimeo:TrackerForVimeoVideos,prepare:function(){this.html5.prepare();this.html5InFrames.prepare();this.youtube.prepare();this.vimeo.prepare()},start:function(){this.html5.start();this.html5InFrames.start();this.youtube.start();this.vimeo.start()},init:function(){this.prepare();this.start()}}}(IO.helpers,document,window,IO.configParser);if(typeof IO=="undefined")var IO={};IO.widgetLoader=function exportWidgetLoader(window,document,defaults,configParser,helpers){var exports={};exports.reload=function(){this.clearDOM();this.insertIntoDOM();configParser.bindOnPageDescriptorAppearance(window.location.href,function(descriptor){_io_widget.configSlices=descriptor.getSlices();_io_widget.configArticleBlockUrl=descriptor.data.page_url;_io_widget.start()}.bind(this))};exports.clearDOM=function(){var widget_element_on_page=document.querySelectorAll('div[data-io-id="_io_widget_element"], script[data-io-id="_io_widget_element"]');for(var i=0;i<widget_element_on_page.length;i++){widget_element_on_page[i].remove()}};exports.insertIntoDOM=function(){var c=document.createElement("div"),b=document.createElement("script");b.type="text/javascript";b.text=this.data.widget.js;c.style.position="static";b.id="_io_widget_element_div";b.dataset.ioId=c.dataset.ioId="_io_widget_element";c.innerHTML=this.data.widget.html;document.body.appendChild(c);document.body.appendChild(b)};exports.startWidget=function(descriptor){this.clearDOM();this.insertIntoDOM();_io_widget.configSlices=descriptor.getSlices();_io_widget.configArticleBlockUrl=descriptor.data.page_url;_io_widget.start(this.data.widget.type,this.data.widget.overall)};exports.load=function(projectHash,projectId,slices){window._io_widget={id:projectId,hash:projectHash};var http=new XMLHttpRequest;var url=function(){if(document.cookie.indexOf("_io_widget_debug")==-1){return"https://widget.onthe.io"}else{return"https://dev"+"_widget.onthe.io"}}();var params={id:projectId,hash:projectHash,title:document.title,force_type:"main_new",path:window.location.pathname+window.location.search};http.open("POST",url,true);http.setRequestHeader("Content-type","application/x-www-form-urlencoded");http.onreadystatechange=function(){if(http.readyState==4&&http.status==200){var data=JSON.parse(http.responseText);if(!data)return;this.data=data;var interval=helpers.setIntervalSafe(window,function(){if(!document.body)return;window.clearInterval(interval);this.startWidget(slices)}.bind(this),1e3)}}.bind(this);var query="";for(var key in params){query+=key+"="+encodeURIComponent(params[key])+"&"}http.send(query)};exports.init=function(){var hashFromLocation=(window.location.hash.match(/^#client-widget-([a-z0-9_]{32})$/i)||[]).pop();var hashFromCookies=(document.cookie.match(/_io_widget=([a-z0-9_]{32})/i)||[]).pop();var hash=hashFromLocation||hashFromCookies;if(!hash)return;var expires=new Date((new Date).setYear((new Date).getFullYear()+1)).toUTCString();var domain=window.location.hostname.replace(/^www\./i,"");var pathname=window.location.pathname;document.cookie="_io_widget="+hash+"; expires="+expires+"; domain="+domain+"; path="+pathname+"";if(hashFromLocation){var url=window.location.protocol+"//"+window.location.hostname+window.location.pathname+window.location.search;history.pushState("",document.title,url)}configParser.bindOnPageDescriptorAppearance(window.location.href,function(descriptor){this.load(hash,defaults.projectId,descriptor)}.bind(this));helpers.bindOnUrlChange(this.reload.bind(this))};return exports}(window,document,IO.defaults,IO.configParser,IO.helpers);if(typeof IO=="undefined")var IO={};IO.instantArticlesTracker=function exportInstantArticlesTracker(window,helpers){var exports={};exports.trackPageviews=function(){var anchor=helpers.parseURL(window.ia_document.shareURL);helpers.sendMetric("pageviews_instant",{url:anchor.pathname,domain:anchor.hostname,depth:1,referrer:"fb_ia",device:"smart (Other)",user_id:helpers.getUserId()})};exports.init=function(){this.trackPageviews()};return exports}(window,IO.helpers);if(typeof IO=="undefined")var IO={};IO.ctrTracker=function exportCtrTracker(window,document,helpers){var exports={};exports.init=function(){function setGlobalPositionAttrs(contentBoxes){if(document.querySelector("[data-vr-global-position]")!==null)return;var i;for(i=0;i<contentBoxes.length;i++){contentBoxes[i].setAttribute("data-vr-global-position",i+1)}}function findParent(child,prentSelector){var parent=child.parentElement;var matches=function(){return Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}return i>-1}}();while(parent){if(matches.call(parent,prentSelector))return parent;parent=parent.parentElement}return null}function getInfoForContentBox(vrContentBoxElement){var vrZoneElement=findParent(vrContentBoxElement,"[data-vr-zone]");var sectionNameElement=findParent(vrContentBoxElement,"[data-section-name]");var vrTitleElement=findParent(vrContentBoxElement,"[data-vr-title]");var title=vrTitleElement?(vrTitleElement.getAttribute("data-vr-title")||"").replace(",","").trim():"";if(title.indexOf("????")!==-1)return false;if(!title)title=vrContentBoxElement.textContent.replace(/\s+/g," ").trim().replace(",","").replace(":","").slice(0,60).trim()+"...";if(title==="...")return false;var slices_object={block_pos:vrContentBoxElement?(vrContentBoxElement.getAttribute("data-vr-contentbox")||"").trim():"",block_zon:vrZoneElement?(vrZoneElement.getAttribute("data-vr-zone")||"").trim():"",block_url:helpers.parseURL(vrContentBoxElement).pathname,block_domain:vrContentBoxElement.hostname,block_global_pos:vrContentBoxElement.getAttribute("data-vr-global-position").trim(),block_title:title,url:window.location.pathname,page:document.title,domain:window.location.hostname,device:helpers.getDeviceName()};return{slices_object:slices_object,zone:slices_object.block_zon}}var contentBoxSelector='[data-vr-zone] [data-vr-contentbox]:not([data-vr-contentbox=""]) a:not([href="#"]):not([href="/"]):not(.io-ignore)'+', [data-vr-zone] a[data-vr-contentbox]:not([data-vr-contentbox=""]):not([href="#"]):not([href="/"]):not(.io-ignore)'+', a[data-vr-zone][data-vr-contentbox]:not([data-vr-contentbox=""]):not([href="#"]):not([href="/"]):not(.io-ignore)';var contentBoxElements=document.querySelectorAll(contentBoxSelector);if(!contentBoxElements)return;setGlobalPositionAttrs(contentBoxElements);var keysToIdentifyBlocksWithTrackedView=[];var keysToIdentifyBlocksWithTrackedClick=[];var contentBoxesObjectsForViewTracking=[];var keysToIdentifyZonesWithTrackedView=[];var separatePageviewForThePageWithBlocksIsSent=false;var i,item,blockTop,blockInfo;for(i=0;i<contentBoxElements.length;i++){item=contentBoxElements[i];blockTop=item.getBoundingClientRect().top;if(blockTop===0)continue;blockInfo=getInfoForContentBox(item);if(!blockInfo)continue;contentBoxesObjectsForViewTracking.push({slices_object:blockInfo.slices_object,top:blockTop-window.innerHeight,track_zon:blockInfo.zone});listenForClicks(blockInfo)}function listenForClicks(blockInfo){helpers.addEventListenerSafe(item,"click",function(){helpers.addEventListenerSafe(window,"beforeunload",function(){if(keysToIdentifyBlocksWithTrackedClick.indexOf(JSON.stringify(blockInfo.slices_object))!==-1)return;keysToIdentifyBlocksWithTrackedClick.push(blockInfo.slices);if(keysToIdentifyBlocksWithTrackedView.indexOf(JSON.stringify(blockInfo.slices_object))==-1)return;helpers.sendMetric("io_block_click",blockInfo.slices_object)})})}function trackView(){for(var item in contentBoxesObjectsForViewTracking){if(contentBoxesObjectsForViewTracking[item].top<=-document.body.getBoundingClientRect().top){if(keysToIdentifyBlocksWithTrackedView.indexOf(contentBoxesObjectsForViewTracking[item].slices_object)===-1){keysToIdentifyBlocksWithTrackedView.push(JSON.stringify(contentBoxesObjectsForViewTracking[item].slices_object));helpers.deferMetricToSendInBatch("io_block_view",contentBoxesObjectsForViewTracking[item].slices_object)}if(keysToIdentifyZonesWithTrackedView.indexOf(contentBoxesObjectsForViewTracking[item].track_zon)===-1){keysToIdentifyZonesWithTrackedView.push(contentBoxesObjectsForViewTracking[item].track_zon);helpers.deferMetricToSendInBatch("io_block_view_sum",contentBoxesObjectsForViewTracking[item].slices_object)}if(!separatePageviewForThePageWithBlocksIsSent){separatePageviewForThePageWithBlocksIsSent=true;helpers.deferMetricToSendInBatch("io_block_view_all",contentBoxesObjectsForViewTracking[item].slices_object)}delete contentBoxesObjectsForViewTracking[item]}}}trackView();var url=location.pathname;var interval=helpers.setIntervalSafe(window,function(){if(url!==location.pathname){clearInterval(interval);return}trackView()},150)};return exports}(window,document,IO.helpers);if(typeof IO=="undefined")var IO={};IO.onClickViewTracker=function exportOnClickViewTracker(window,document,helpers,configParser){var exports={};exports.bindOneElement=function(element){helpers.addEventListenerSafe(element,"click",function(){configParser.bindOnPageDescriptorAppearance(window.location.href,function(pageDescriptor){helpers.sendMetric("pageviews",pageDescriptor.getSlices())})})};exports.bindExistingElemets=function(selector){var elements=document.querySelectorAll(selector);elements=window.Array.prototype.slice.call(elements);for(var i=0;i<elements.length;i++){this.bindOneElement(elements[i])}};exports.listenForNewElements=function(selector){helpers.bindOnElementInsertion(selector,function(element){this.bindOneElement(element)}.bind(this))};exports.init=function(){if(typeof customCode_onClickViewSelector=="undefined")return;this.bindExistingElemets(customCode_onClickViewSelector);this.listenForNewElements(customCode_onClickViewSelector)};return exports}(window,document,IO.helpers,IO.configParser);IO.configParser.PageDescriptor.getSlices=function(){this.data.page_url_canonical="";var slices=IO.configParser.getSlicesFromPageDescriptor(this.data);IO.configParser.appendDefaultSlices(slices,this.data.page_url,slices.url);return slices};if(IO.doubleLoadingDetector.init())return;if(IO.rawCodeLoader.init())return;IO.helpers.loadComponentAsync(IO.eventAPI);if(window.ia_document){IO.instantArticlesTracker.init();return}IO.helpers.loadComponentAsync(IO.uniqueTracker);IO.helpers.loadComponentAsync(IO.holdingUniqueTracker);IO.helpers.loadComponentAsync(IO.visitTracker);IO.helpers.loadComponentAsync(IO.viewTracker);IO.helpers.loadComponentAsync(IO.readabilityTracker);IO.helpers.loadComponentAsync(IO.timeTracker);IO.helpers.loadComponentAsync(IO.videoTracker);IO.helpers.loadComponentAsync(IO.ctrTracker);IO.helpers.loadComponentAsync(IO.widgetLoader);IO.helpers.loadComponentAsync(IO.onClickViewTracker)}catch(error){try{IO.helpers.trackErrorMetric(error)}catch(error){}}})();
