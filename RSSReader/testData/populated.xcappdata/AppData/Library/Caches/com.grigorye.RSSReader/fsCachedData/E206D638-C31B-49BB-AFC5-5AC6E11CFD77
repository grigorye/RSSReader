/*! jQuery UI - v1.10.3 - 2013-11-20
* http://jqueryui.com
* Includes: jquery.ui.effect.js, jquery.ui.effect-shake.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
!function(e,t){var i="ui-effects-";e.effects={effect:{}},function(e,t){function i(e,t,i){var s=c[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),a=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,n){var r,o=n.re.exec(i),h=o&&n.parse(o),l=n.space||"rgba";return h?(r=s[l](h),s[u[l].cache]=r[u[l].cache],a=s._rgba=r._rgba,!1):t}),a.length?("0,0,0,0"===a.join()&&e.extend(a,n.transparent),s):n[i]}function a(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var n,r="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",o=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,a){return new e.Color.fn.parse(t,i,s,a)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(a,r,o,h){if(a===t)return this._rgba=[null,null,null,null],this;(a.jquery||a.nodeType)&&(a=e(a).css(r),r=t);var c=this,d=e.type(a),p=this._rgba=[];return r!==t&&(a=[a,r,o,h],d="array"),"string"===d?this.parse(s(a)||n._default):"array"===d?(f(u.rgba.props,function(e,t){p[t.idx]=i(a[t.idx],t)}),this):"object"===d?(a instanceof l?f(u,function(e,t){a[t.cache]&&(c[t.cache]=a[t.cache].slice())}):f(u,function(t,s){var n=s.cache;f(s.props,function(e,t){if(!c[n]&&s.to){if("alpha"===e||null==a[e])return;c[n]=s.to(c._rgba)}c[n][t.idx]=i(a[e],t,!0)}),c[n]&&0>e.inArray(null,c[n].slice(0,3))&&(c[n][3]=1,s.from&&(c._rgba=s.from(c[n])))}),this):t},is:function(e){var i=l(e),s=!0,a=this;return f(u,function(e,n){var r,o=i[n.cache];return o&&(r=a[n.cache]||n.to&&n.to(a._rgba)||[],f(n.props,function(e,i){return null!=o[i.idx]?s=o[i.idx]===r[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),a=s._space(),n=u[a],r=0===this.alpha()?l("transparent"):this,o=r[n.cache]||n.to(r._rgba),h=o.slice();return s=s[n.cache],f(n.props,function(e,a){var n=a.idx,r=o[n],l=s[n],u=c[a.type]||{};null!==l&&(null===r?h[n]=l:(u.mod&&(l-r>u.mod/2?r+=u.mod:r-l>u.mod/2&&(r-=u.mod)),h[n]=i((l-r)*t+r,a)))}),this[a](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),a=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*a[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,a=e[1]/255,n=e[2]/255,r=e[3],o=Math.max(s,a,n),h=Math.min(s,a,n),l=o-h,u=o+h,c=.5*u;return t=h===o?0:s===o?60*(a-n)/l+360:a===o?60*(n-s)/l+120:60*(s-a)/l+240,i=0===l?0:.5>=c?l/u:l/(2-u),[Math.round(t)%360,i,c,null==r?1:r]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],n=e[3],r=.5>=s?s*(1+i):s+i-s*i,o=2*s-r;return[Math.round(255*a(o,r,t+1/3)),Math.round(255*a(o,r,t)),Math.round(255*a(o,r,t-1/3)),n]},f(u,function(s,a){var n=a.props,r=a.cache,h=a.to,u=a.from;l.fn[s]=function(s){if(h&&!this[r]&&(this[r]=h(this._rgba)),s===t)return this[r].slice();var a,o=e.type(s),c="array"===o||"object"===o?s:arguments,d=this[r].slice();return f(n,function(e,t){var s=c["object"===o?e:t.idx];null==s&&(s=d[t.idx]),d[t.idx]=i(s,t)}),u?(a=l(u(d)),a[r]=d,a):l(d)},f(n,function(t,i){l.fn[t]||(l.fn[t]=function(a){var n,r=e.type(a),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===r?u:("function"===r&&(a=a.call(this,u),r=e.type(a)),null==a&&i.empty?this:("string"===r&&(n=o.exec(a),n&&(a=u+parseFloat(n[2])*("+"===n[1]?1:-1))),l[i.idx]=a,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,a){var n,r,o="";if("transparent"!==a&&("string"!==e.type(a)||(n=s(a)))){if(a=l(n||a),!d.rgba&&1!==a._rgba[3]){for(r="backgroundColor"===i?t.parentNode:t;(""===o||"transparent"===o)&&r&&r.style;)try{o=e.css(r,"backgroundColor"),r=r.parentNode}catch(h){}a=a.blend(o&&"transparent"!==o?o:"_default")}a=a.toRgbaString()}try{t.style[i]=a}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(r),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},n=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(t){var i,s,a=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,n={};if(a&&a.length&&a[0]&&a[a[0]])for(s=a.length;s--;)i=a[s],"string"==typeof a[i]&&(n[e.camelCase(i)]=a[i]);else for(i in a)"string"==typeof a[i]&&(n[i]=a[i]);return n}function s(t,i){var s,a,r={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(r[s]=a));return r}var a=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,n,r,o){var h=e.speed(n,r,o);return this.queue(function(){var n,r=e(this),o=r.attr("class")||"",l=h.children?r.find("*").addBack():r;l=l.map(function(){var t=e(this);return{el:t,start:i(this)}}),n=function(){e.each(a,function(e,i){t[i]&&r[i+"Class"](t[i])})},n(),l=l.map(function(){return this.end=i(this.el[0]),this.diff=s(this.start,this.end),this}),r.attr("class",o),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){n(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(r[0])})})},e.fn.extend({addClass:function(t){return function(i,s,a,n){return s?e.effects.animateClass.call(this,{add:i},s,a,n):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,a,n){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,a,n):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(i){return function(s,a,n,r,o){return"boolean"==typeof a||a===t?n?e.effects.animateClass.call(this,a?{add:s}:{remove:s},n,r,o):i.apply(this,arguments):e.effects.animateClass.call(this,{toggle:s},a,n,r)}}(e.fn.toggleClass),switchClass:function(t,i,s,a,n){return e.effects.animateClass.call(this,{add:i,remove:t},s,a,n)}})}(),function(){function s(t,i,s,a){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(a=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(a=s,s=i,i={}),e.isFunction(s)&&(a=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=a||i.complete,t}function a(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.3",save:function(e,t){for(var s=0;t.length>s;s++)null!==t[s]&&e.data(i+t[s],e[0].style[t[s]])},restore:function(e,s){var a,n;for(n=0;s.length>n;n++)null!==s[n]&&(a=e.data(i+s[n]),a===t&&(a=""),e.css(s[n],a))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),a={width:t.width(),height:t.height()},n=document.activeElement;try{n.id}catch(r){n=document.body}return t.wrap(s),(t[0]===n||e.contains(t[0],n))&&e(n).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(a),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,a){return a=a||{},e.each(i,function(e,i){var n=t.cssUnit(i);n[0]>0&&(a[i]=n[0]*s+n[1])}),a}}),e.fn.extend({effect:function(){function t(t){function s(){e.isFunction(n)&&n.call(a[0]),e.isFunction(t)&&t()}var a=e(this),n=i.complete,o=i.mode;(a.is(":hidden")?"hide"===o:"show"===o)?(a[o](),s()):r.call(a[0],i,s)}var i=s.apply(this,arguments),a=i.mode,n=i.queue,r=e.effects.effect[i.effect];return e.fx.off||!r?a?this[a](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):n===!1?this.each(t):this.queue(n||"fx",t)},show:function(e){return function(t){if(a(t))return e.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(e.fn.show),hide:function(e){return function(t){if(a(t))return e.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(e.fn.hide),toggle:function(e){return function(t){if(a(t)||"boolean"==typeof t)return e.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}()}(jQuery),function(e){e.effects.effect.shake=function(t,i){var s,a=e(this),n=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"effect"),o=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===o||"down"===o?"top":"left",p="up"===o||"left"===o,f={},m={},g={},v=a.queue(),y=v.length;for(e.effects.save(a,n),a.show(),e.effects.createWrapper(a),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,a.animate(f,d,t.easing),s=1;l>s;s++)a.animate(m,d,t.easing).animate(g,d,t.easing);a.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===r&&a.hide(),e.effects.restore(a,n),e.effects.removeWrapper(a),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),a.dequeue()}}(jQuery),/*!
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
function(jQuery){function newTmplItem(options,parentItem,fn,data){var newItem={data:data||0===data||data===!1?data:parentItem?parentItem.data:{},_wrap:parentItem?parentItem._wrap:null,tmpl:null,parent:parentItem||null,nodes:[],calls:tiCalls,nest:tiNest,wrap:tiWrap,html:tiHtml,update:tiUpdate};return options&&jQuery.extend(newItem,options,{nodes:[],parent:parentItem}),fn&&(newItem.tmpl=fn,newItem._ctnt=newItem._ctnt||newItem.tmpl(jQuery,newItem),newItem.key=++itemKey,(stack.length?wrappedItems:newTmplItems)[itemKey]=newItem),newItem}function build(tmplItem,nested,content){var frag,ret=content?jQuery.map(content,function(item){return"string"==typeof item?tmplItem.key?item.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+tmplItmAtt+'="'+tmplItem.key+'" $2'):item:build(item,tmplItem,item._ctnt)}):tmplItem;return nested?ret:(ret=ret.join(""),ret.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(all,before,middle,after){frag=jQuery(middle).get(),storeTmplItems(frag),before&&(frag=unencode(before).concat(frag)),after&&(frag=frag.concat(unencode(after)))}),frag?frag:unencode(ret))}function unencode(text){var el=document.createElement("div");return el.innerHTML=text,jQuery.makeArray(el.childNodes)}function buildTmplFn(markup){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+jQuery.trim(markup).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(all,slash,type,fnargs,target,parens,args){var def,expr,exprAutoFnDetect,tag=jQuery.tmpl.tag[type];if(!tag)throw"Unknown template tag: "+type;return def=tag._default||[],parens&&!/\w$/.test(target)&&(target+=parens,parens=""),target?(target=unescape(target),args=args?","+unescape(args)+")":parens?")":"",expr=parens?target.indexOf(".")>-1?target+unescape(parens):"("+target+").call($item"+args:target,exprAutoFnDetect=parens?expr:"(typeof("+target+")==='function'?("+target+").call($item):("+target+"))"):exprAutoFnDetect=expr=def.$1||"null",fnargs=unescape(fnargs),"');"+tag[slash?"close":"open"].split("$notnull_1").join(target?"typeof("+target+")!=='undefined' && ("+target+")!=null":"true").split("$1a").join(exprAutoFnDetect).split("$1").join(expr).split("$2").join(fnargs||def.$2||"")+"__.push('"})+"');}return __;")}function updateWrapped(options,wrapped){options._wrap=build(options,!0,jQuery.isArray(wrapped)?wrapped:[htmlExpr.test(wrapped)?wrapped:jQuery(wrapped).html()]).join("")}function unescape(args){return args?args.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function outerHtml(elem){var div=document.createElement("div");return div.appendChild(elem.cloneNode(!0)),div.innerHTML}function storeTmplItems(content){function processItemKey(el){function cloneTmplItem(key){key+=keySuffix,tmplItem=newClonedItems[key]=newClonedItems[key]||newTmplItem(tmplItem,newTmplItems[tmplItem.parent.key+keySuffix]||tmplItem.parent)}var pntKey,pntItem,tmplItem,key,pntNode=el;if(key=el.getAttribute(tmplItmAtt)){for(;pntNode.parentNode&&1===(pntNode=pntNode.parentNode).nodeType&&!(pntKey=pntNode.getAttribute(tmplItmAtt)););pntKey!==key&&(pntNode=pntNode.parentNode?11===pntNode.nodeType?0:pntNode.getAttribute(tmplItmAtt)||0:0,(tmplItem=newTmplItems[key])||(tmplItem=wrappedItems[key],tmplItem=newTmplItem(tmplItem,newTmplItems[pntNode]||wrappedItems[pntNode]),tmplItem.key=++itemKey,newTmplItems[itemKey]=tmplItem),cloneIndex&&cloneTmplItem(key)),el.removeAttribute(tmplItmAtt)}else cloneIndex&&(tmplItem=jQuery.data(el,"tmplItem"))&&(cloneTmplItem(tmplItem.key),newTmplItems[tmplItem.key]=tmplItem,pntNode=jQuery.data(el.parentNode,"tmplItem"),pntNode=pntNode?pntNode.key:0);if(tmplItem){for(pntItem=tmplItem;pntItem&&pntItem.key!=pntNode;)pntItem.nodes.push(el),pntItem=pntItem.parent;delete tmplItem._ctnt,delete tmplItem._wrap,jQuery.data(el,"tmplItem",tmplItem)}}var elem,elems,i,l,m,keySuffix="_"+cloneIndex,newClonedItems={};for(i=0,l=content.length;l>i;i++)if(1===(elem=content[i]).nodeType){for(elems=elem.getElementsByTagName("*"),m=elems.length-1;m>=0;m--)processItemKey(elems[m]);processItemKey(elem)}}function tiCalls(content,tmpl,data,options){return content?void stack.push({_:content,tmpl:tmpl,item:this,data:data,options:options}):stack.pop()}function tiNest(tmpl,data,options){return jQuery.tmpl(jQuery.template(tmpl),data,options,this)}function tiWrap(call,wrapped){var options=call.options||{};return options.wrapped=wrapped,jQuery.tmpl(jQuery.template(call.tmpl),call.data,options,call.item)}function tiHtml(filter,textOnly){var wrapped=this._wrap;return jQuery.map(jQuery(jQuery.isArray(wrapped)?wrapped.join(""):wrapped).filter(filter||"*"),function(e){return textOnly?e.innerText||e.textContent:e.outerHTML||outerHtml(e)})}function tiUpdate(){var coll=this.nodes;jQuery.tmpl(null,null,null,this).insertBefore(coll[0]),jQuery(coll).remove()}var appendToTmplItems,oldManip=jQuery.fn.domManip,tmplItmAtt="_tmplitem",htmlExpr=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,newTmplItems={},wrappedItems={},topTmplItem={key:0,data:{}},itemKey=0,cloneIndex=0,stack=[];jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i,l,tmplItems,ret=[],insert=jQuery(selector),parent=1===this.length&&this[0].parentNode;if(appendToTmplItems=newTmplItems||{},parent&&11===parent.nodeType&&1===parent.childNodes.length&&1===insert.length)insert[original](this[0]),ret=this;else{for(i=0,l=insert.length;l>i;i++)cloneIndex=i,elems=(i>0?this.clone(!0):this).get(),jQuery(insert[i])[original](elems),ret=ret.concat(elems);cloneIndex=0,ret=this.pushStack(ret,name,insert.selector)}return tmplItems=appendToTmplItems,appendToTmplItems=null,jQuery.tmpl.complete(tmplItems),ret}}),jQuery.fn.extend({tmpl:function(data,options,parentItem){return jQuery.tmpl(this[0],data,options,parentItem)},tmplItem:function(){return jQuery.tmplItem(this[0])},template:function(name){return jQuery.template(name,this[0])},domManip:function(args,table,callback){if(args[0]&&jQuery.isArray(args[0])){for(var tmplItem,dmArgs=jQuery.makeArray(arguments),elems=args[0],elemsLength=elems.length,i=0;elemsLength>i&&!(tmplItem=jQuery.data(elems[i++],"tmplItem")););tmplItem&&cloneIndex&&(dmArgs[2]=function(fragClone){jQuery.tmpl.afterManip(this,fragClone,callback)}),oldManip.apply(this,dmArgs)}else oldManip.apply(this,arguments);return cloneIndex=0,appendToTmplItems||jQuery.tmpl.complete(newTmplItems),this}}),jQuery.extend({tmpl:function(tmpl,data,options,parentItem){var ret,topLevel=!parentItem;if(topLevel)parentItem=topTmplItem,tmpl=jQuery.template[tmpl]||jQuery.template(null,tmpl),wrappedItems={};else if(!tmpl)return tmpl=parentItem.tmpl,newTmplItems[parentItem.key]=parentItem,parentItem.nodes=[],parentItem.wrapped&&updateWrapped(parentItem,parentItem.wrapped),jQuery(build(parentItem,null,parentItem.tmpl(jQuery,parentItem)));return tmpl?("function"==typeof data&&(data=data.call(parentItem||{})),options&&options.wrapped&&updateWrapped(options,options.wrapped),ret=jQuery.isArray(data)?jQuery.map(data,function(dataItem){return dataItem?newTmplItem(options,parentItem,tmpl,dataItem):null}):[newTmplItem(options,parentItem,tmpl,data)],topLevel?jQuery(build(parentItem,null,ret)):ret):[]},tmplItem:function(elem){var tmplItem;for(elem instanceof jQuery&&(elem=elem[0]);elem&&1===elem.nodeType&&!(tmplItem=jQuery.data(elem,"tmplItem"))&&(elem=elem.parentNode););return tmplItem||topTmplItem},template:function(name,tmpl){return tmpl?("string"==typeof tmpl?tmpl=buildTmplFn(tmpl):tmpl instanceof jQuery&&(tmpl=tmpl[0]||{}),tmpl.nodeType&&(tmpl=jQuery.data(tmpl,"tmpl")||jQuery.data(tmpl,"tmpl",buildTmplFn(tmpl.innerHTML))),"string"==typeof name?jQuery.template[name]=tmpl:tmpl):name?"string"!=typeof name?jQuery.template(null,name):jQuery.template[name]||jQuery.template(null,htmlExpr.test(name)?name:jQuery(name)):null},encode:function(text){return(""+text).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),jQuery.extend(jQuery.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){newTmplItems={}},afterManip:function(elem,fragClone,callback){var content=11===fragClone.nodeType?jQuery.makeArray(fragClone.childNodes):1===fragClone.nodeType?[fragClone]:[];callback.call(elem,fragClone),storeTmplItems(content),cloneIndex++}})}(jQuery),window.AuthWeb={},function($,app){function Translation(){var t={en:{signup:"Sign up",login:"Login",reset:"Reset password",via_social:"via social media account",auth_separator:"or",back_button:"Back",back_to_site_button:"Back to site",reset_button:"Reset",letter_sent:"An email with link to reset password has been sent to",change_password_button:"Change password",password_changed:"Your password was changed",twitter_signup:"Twitter Signup",create_new_account:"Create new account",account_activated:"Your account was activated",account_unactivated:"Your account was not activated",existed_profile:"You already have an account Look At Media on email",labels:{email:"E-mail",password:"Password",full_name:"Name"}},ru:{signup:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",login:"\u0412\u043e\u0439\u0442\u0438",reset:"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c",via_social:"\u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 \u0432 \u0441\u043e\u0446. \u0441\u0435\u0442\u044f\u0445",auth_separator:"\u0438\u043b\u0438",back_button:"\u041d\u0430\u0437\u0430\u0434",back_to_site_button:"\u041d\u0430\u0437\u0430\u0434 \u043d\u0430 \u0441\u0430\u0439\u0442",reset_button:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c",letter_sent:"\u041f\u0438\u0441\u044c\u043c\u043e \u0441\u043e \u0441\u0441\u044b\u043b\u043a\u043e\u0439 \u043d\u0430 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u043d\u0430",change_password_button:"\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c",password_changed:"\u0412\u0430\u0448 \u043f\u0430\u0440\u043e\u043b\u044c \u0431\u044b\u043b \u0438\u0437\u043c\u0435\u043d\u0435\u043d",twitter_signup:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u0447\u0435\u0440\u0435\u0437 Twitter",create_new_account:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0434\u0440\u0443\u0433\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442",account_activated:"\u0412\u0430\u0448 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u0431\u044b\u043b \u0430\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u043d",account_unactivated:"\u0412\u0430\u0448 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 \u043d\u0435 \u0431\u044b\u043b \u0430\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u043d",existed_profile:"\u0423 \u0432\u0430\u0441 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442 Look At Media \u043d\u0430 \u043f\u043e\u0447\u0442\u0443",labels:{email:"\u042d\u043b. \u043f\u043e\u0447\u0442\u0430",password:"\u041f\u0430\u0440\u043e\u043b\u044c",full_name:"\u0418\u043c\u044f"}}};return{get:function(locale){return t[locale]&&t[locale]?t[locale]:t.ru}}}app.Translation=Translation}(jQuery,AuthWeb),function($,app){function CrossDomainStorage(token){this.origin=(AUTH.use_ssl?"https":"http")+"://auth.look-at-media.com",this.path="/api/sessions.html?client_id="+AUTH.client_id,this.token=token?token:"",this._iframe=null,this._iframeReady=!1,this._queue=[],this._requests={},this._id=0,window.storage=this}CrossDomainStorage.prototype={constructor:CrossDomainStorage,init:function(){var that=this;if(!this._iframe){if(!(window.postMessage&&window.JSON&&window.localStorage))throw new Error("Unsupported browser.");this._iframe=document.createElement("iframe"),this._iframe.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;",document.body.appendChild(this._iframe),window.addEventListener?(this._iframe.addEventListener("load",function(){that._iframeLoaded()},!1),window.addEventListener("message",function(event){that._handleMessage(event)},!1)):this._iframe.attachEvent&&(this._iframe.attachEvent("onload",function(){that._iframeLoaded()},!1),window.attachEvent("onmessage",function(event){that._handleMessage(event)}))}this.setSrc(this.token)},setSrc:function(token){token&&(this.token=token),this._iframe&&(this._iframe.src=this.origin+this.path+"&token="+this.token)},requestValue:function(key,callback){var request={key:key,id:++this._id},data={request:request,callback:callback};this._iframeReady?this._sendRequest(data):this._queue.push(data),this._iframe||this.init()},_sendRequest:function(data){this._requests[data.request.id]=data,this._iframe.contentWindow.postMessage(JSON.stringify(data.request),this.origin)},_isEmpty:function(){return this._iframeReady&&0==this._queue.length},_iframeLoaded:function(){if(this._iframeReady=!0,this._queue.length){for(var i=0,len=this._queue.length;len>i;i++)this._sendRequest(this._queue[i]);this._queue=[]}},_handleMessage:function(event){if(event.origin==this.origin){var data=JSON.parse(event.data);this._requests[data.id]&&(this._requests[data.id].callback(data.key,data.value),this._requests[data.id]=null),delete this._requests[data.id]}},remove:function(){this._iframe&&($(this._iframe).remove(),this._iframe=null)}},app.CrossDomainStorage=CrossDomainStorage}(jQuery,AuthWeb),function($,app){function AuthServiceFactory(options){this.options=options,this.remote_storage=new app.CrossDomainStorage}AuthServiceFactory.prototype.isLogin=function(callback){this.remote_storage.requestValue("usershow",callback)},AuthServiceFactory.prototype.loginByToken=function(token,callback){this.remote_storage.remove&&this.remote_storage.remove(),this.remote_storage=new app.CrossDomainStorage(token),this.remote_storage.setSrc(token),this.remote_storage.requestValue("usershow",callback)},AuthServiceFactory.prototype.login=function(){var url=this.options.provider_login;0==AUTH.with_provider&&(url=this.options.direct_login+"redirect_uri="+AUTH.redirect_uri+"&client_id="+AUTH.client_id+"&response_type=token"),window.location.href=url},AuthServiceFactory.prototype.return_to_site=function(with_provider){var parameter=with_provider?"?auth_web=user_password_pending":"";this.options.redirect_url&&(window.location.href=this.options.redirect_url+parameter)};var options={api_url:(AUTH.use_ssl===!0?"https":"http")+"://auth.look-at-media.com/api/",redirect_url:AUTH.redirect_url,provider_login:AUTH.provider_login,direct_login:(AUTH.use_ssl===!0?"https":"http")+"://auth.look-at-media.com/oauth/authorize?"};app.AuthService=new AuthServiceFactory(options)}(jQuery,AuthWeb),function($,app){function getUrlVars(){for(var hash,vars=[],hashes=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++)hash=hashes[i].split("="),vars.push(hash[0]),vars[hash[0]]=hash[1];return vars}function AuthController(){this.root_el=$("body"),this.bg_loaded=!1,this.initialized=!1,this.root_el.on("keyup","#auth_form input",$.proxy(this.keyup_handler,this)),this.root_el.on("keypress","#auth_for input",$.proxy(this.keypress_handler,this)),this.root_el.on("click",'#auth_form button:not([type="submit"])',$.proxy(this.submit_form,this)),this.root_el.on("click",".auth_login_social_link_list a",function(){$(this).removeClass().addClass("spinner")}),this.root_el.on("click",".auth_close",$.proxy(this.close,this)),$(window).on("hashchange",$.proxy(this.routing,this)),this.routing(),AUTH.force_state&&(window.location.hash=AUTH.force_state)}var layout_mobile_template='     <div class="auth_bubbled auth_mobile">       <div class="auth_logo"></div>       <div class="auth_login_block"></div>     </div>',layout_template='     <div data-bg-loader="https://auth.look-at-media.com/gui/big_bg-7bb7388be59b055f9c4166e342ddaf58.jpg" class="auth_bubbled">       <i class="auth_close"></i>       <div class="auth_logo"></div>       <div class="auth_form-wrap">         <div class="auth_login_block"></div>      </div>       <ul class="auth_sites_logo">         <li><span class="lookatme">Look At Me</span></li>         <li><span class="village">The Village</span></li>         <li><span class="wonderzine">Wonderzine</span></li>         <li><span class="furfur">Furfur</span></li>       </ul>       <i class="auth_bg-preloader"></i>     </div>',auth_menu_desktop_template='    <div id="auth_menu">       <div class="auth_login_form_menu auth_session">         <ul class="auth_login_menu_links">           <li class="signup"><a href="#signup">${signup}</a></li>           <li class="login"><a href="#login">${login}</a></li>         </ul>       </div>     </div>',auth_menu_mobile_template='<p class="auth_logo_caption">${login}</p>',auth_social_links_template='    <div id="auth_social_links">       <div class="auth_login_social_links">         <p>${via_social}</p>         <ul class="auth_login_social_link_list">           <li><a href="https://auth.look-at-media.com/auth/vkontakte?auth_force=1&auth_client_id=${client_id}" class="vk">VK</a></li>           <li><a href="https://auth.look-at-media.com/auth/facebook?auth_force=1&auth_client_id=${client_id}" class="fb">Facebook</a></li>           <li><a href="https://auth.look-at-media.com/auth/twitter?auth_force=1&auth_client_id=${client_id}" class="tw">Twitter</a></li>           <li><a href="https://auth.look-at-media.com/auth/google_oauth2?auth_force=1&auth_client_id=${client_id}" class="gplus">Google +</a></li>         </ul>         <p class="auth_separator">${auth_separator}</p>       </div>     </div>',disclaimer_template_ru='     \u041d\u0430\u0436\u0438\u043c\u0430\u044f \u043d\u0430 \u043a\u043d\u043e\u043f\u043a\u0443 \xab\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f\xbb, \u0432\u044b     <br/> \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u0441\u0432\u043e\u0435 \u0441\u043e\u0433\u043b\u0430\u0441\u0438\u0435 \u0441 \u0443\u0441\u043b\u043e\u0432\u0438\u044f\u043c\u0438 <br/> \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f     \u0443\u0441\u043b\u0443\u0433 (<a href="/pages/license">\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0435 <br/>     \u0441\u043e\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435</a>)',disclaimer_template_en='When you click "Registration" button you agree with <a href="/pages/license">Terms of Service</a>',error_template='<i class="auth_login_form-error-tooltip"><span>${message}</span></i>',error_mobile_template='<ul class="auth_top_errors_block"></ul>',sessions_template='      <div class="auth_login_form">         <form class="auth_login_form-fields" action="https://auth.look-at-media.com/api/sessions.json" name="form" id="auth_form" method="post" autocomplete="off" novalidate>           <div class="auth_login_form-inputs-group">             <div class="auth_login_form-text-input">               <input type="email" name="user[email]" class="auth_login_form-text-input--first" placeholder="${labels.email}" id="auth_user_email" autocomplete="off">             </div>             <div class="auth_login_form-text-input">               <input type="password" name="user[password]" class="auth_login_form-text-input--last" placeholder="${labels.password}" id="auth_user_password" autocomplete="off">             </div>             <input type="hidden" name="client_id" value="${client_id}" />           </div>           <button class="auth_login_form-btn">${login}</button>           <p class="auth_change"><a href="#reset">${reset}</a></p>         </form>     </div>',signup_template='     <div class="auth_login_form">       <form class="auth_login_form-fields" action="https://auth.look-at-media.com/api/registrations.json" name="form" id="auth_form" method="post" autocomplete="off" novalidate>         <div class="auth_login_form-inputs-group">           <div class="auth_login_form-text-input">             <input type="text" name="user[profile_attributes][full_name]" placeholder="${labels.full_name}" class="auth_login_form-text-input--first">           </div>           <div class="auth_login_form-text-input">             <input type="email" name="user[email]" placeholder="${labels.email}" value="">           </div>           <div class="auth_login_form-text-input">             <input type="password" name="user[password]" class="auth_login_form-text-input--last" placeholder="${labels.password}">           </div>           <input type="hidden" name="client_id" value="${client_id}" />         </div>         <button class="auth_login_form-btn">${signup}</button>         <p class="auth_login_form-disclaimer"></p>       </form>     </div>',profile_template='  <div class="auth_login_form auth_login_form--profile">     <p class="auth_login_form--profile-description">${existed_profile} <span class="auth_email"></span></p>     <div class="auth_login_form--profile-avatar_wrapper">       <img src="https://auth.look-at-media.com/images/default/userpic-medium.png" class="auth_login_form--profile-avatar" />     </div>     <form class="auth_login_form-fields" action="https://auth.look-at-media.com/api/registrations.json" id="auth_form" method="POST" autocomplete="off" name="form" novalidate>       <div class="auth_login_form-inputs-group">         <div class="auth_login_form-text-input">           <input type="text" name="user[profile_attributes][full_name]" class="auth_profile_full_name auth_login_form-text-input--first auth_login_form-text-input--last" placeholder="${labels.full_name}">           </div>         </div>         <input type="hidden" name="user[email]" class="auth_email" />         <input type="hidden" name="token" class="auth_single_access_token" />         <input type="hidden" name="client_id" value="${client_id}" />         <button class="auth_login_form-btn">${login}</button>         <p class="auth_login_form--profile-change">           <a href="#signup">${create_new_account}</a>         </p>       </div>     </form>   </div>',reset_template='    <div class="auth_login_form auth_login_form--reset-pass">       <p class="auth_login-title">${reset}</p>       <form class="auth_login_form-fields" action="https://auth.look-at-media.com/api/passwords.json" id="auth_form" method="POST" autocomplete="off" name="form" novalidate>         <div class="auth_login_form-inputs-group">           <div class="auth_login_form-text-input">             <input type="email" name="user[email]" class="auth_login_form-text-input--first auth_login_form-text-input--last" placeholder="${labels.email}">           </div>         </div>         <input type="hidden" name="client_id" value="${client_id}" />         <button class="auth_login_form-btn">${reset}</button>         <p class="auth_change"><a href="#login">\u2190 ${back_button}</a></p>       </form>     </div>',letter_sent_template='<p>${letter_sent} <span class="auth_email"></span>.</p>',update_password_template='  <div class="auth_login_form auth_login_form--reset-pass">     <form class="auth_login_form-fields" action="https://auth.look-at-media.com/api/passwords.json" id="auth_form" method="PUT" name="form" autocomplete="off" novalidate>       <p>${reset}</p>       <div class="auth_login_form-inputs-group">         <div class="auth_login_form-text-input">           <input type="password" name="user[password]" class="auth_login_form-text-input--first auth_login_form-text-input--last" placeholder="${labels.password}">         </div>       </div>       <input type="hidden" name="client_id" value="${client_id}" />       <input type="hidden" name="code" id="auth_code" required />       <button class="auth_login_form-btn">${change_password_button}</button>     </form>   </div>',password_changed_template='    <p>${password_changed}</p>     <a class="auth_login_form-btn" href="${redirect_uri}">${back_to_site_button}</a>',activation_template='     <div class="auth_login_form auth_login_form--activation">       <p class="auth_activated" style="display: none">${account_activated}</p>       <p class="auth_unactivated" style="display: none">${account_unactivated}</p>       <a class="auth_login_form-btn" href="${redirect_uri}" id="auth_redirect_uri" target="_self">${back_to_site_button}</a>     </div>',twitter_confirm_template='  <div class="auth_login_form auth_login_form--reset-pass">     <p class="auth_login_form-social"><i class="auth_login_form-social-logo tw"></i></p>     <p>${twitter_signup}</p>     <form class="auth_login_form-fields" action="https://auth.look-at-media.com/api/registrations.json" name="form" id="auth_form" method="post" autocomplete="off" novalidate>       <div class="auth_login_form-inputs-group">         <div class="auth_login_form-text-input">           <input type="text" name="user[profile_attributes][full_name]" class="auth_full_name" class="auth_login_form-text-input--first" placeholder="${labels.full_name}">         </div>         <div class="auth_login_form-text-input">           <input type="email" name="user[email]" class="auth_login_form-text-input--last auth_email" placeholder="${labels.email}">         </div>         <input type="hidden" name="client_id" value="${client_id}" />         <input type="hidden" name="user[auth_provider_attributes][uid]" class="auth_uid" />         <input type="hidden" name="user[auth_provider_attributes][provider]" class="auth_provider" />       </div>       <button class="auth_login_form-btn">${signup}</button>     </form>   </div>',spinner_template='<div class="auth_spinner_wrap" style="left: 100%; opacity: 0"><i class="auth_spinner"></i></div>',translation=(new app.Translation).get(AUTH.locale),main_layout_template=1==AUTH.mobile?layout_mobile_template:layout_template,auth_menu_template=1==AUTH.mobile?auth_menu_mobile_template:auth_menu_desktop_template;auth_social_links_template=auth_social_links_template.replace(/https?/,AUTH.use_ssl===!0?"https":"http"),auth_social_links_template=$.tmpl(auth_social_links_template,$.extend({},translation,AUTH)),auth_menu_template=$.tmpl(auth_menu_template,$.extend({},translation,AUTH)),sessions_template=$.tmpl(sessions_template,$.extend({},translation,AUTH)),signup_template=$.tmpl(signup_template,$.extend({},translation,AUTH)),profile_template=$.tmpl(profile_template,$.extend({},translation,AUTH,CurrentUser)),reset_template=$.tmpl(reset_template,$.extend({},translation,AUTH,CurrentUser)),letter_sent_template=$.tmpl(letter_sent_template,$.extend({},translation,AUTH,CurrentUser)),update_password_template=$.tmpl(update_password_template,$.extend({},translation,AUTH,CurrentUser)),password_changed_template=$.tmpl(password_changed_template,$.extend({},translation,AUTH,CurrentUser)),activation_template=$.tmpl(activation_template,$.extend({},translation,AUTH,CurrentUser)),twitter_confirm_template=$.tmpl(twitter_confirm_template,$.extend({},translation,AUTH,CurrentUser));var TwitterConfirmController=function(parent_controller){this.parent_controller=parent_controller,this.template=twitter_confirm_template};TwitterConfirmController.prototype.init=function(){$(".auth_login_block").html(""),$(".auth_login_block").append(this.template);var queryParams=getUrlVars();CurrentUser={full_name:decodeURIComponent(queryParams.full_name),provider:queryParams.provider,sex:queryParams.sex,uid:queryParams.uid},$(".auth_email").val(CurrentUser.email),$(".auth_full_name").val(CurrentUser.full_name),$(".auth_sex").val(CurrentUser.sex),$(".auth_provider").val(CurrentUser.provider),$(".auth_uid").val(CurrentUser.uid)},TwitterConfirmController.prototype.callbacks={success:function(data){switch(data.code){case-2:this.parent_controller.error_handler(data.errors,$("#auth_form"));break;case 0:app.AuthService.loginByToken(data.user.single_access_token,function(){window.location.href=AUTH.provider_login})}}};var ActivationController=function(){this.template=activation_template};ActivationController.prototype.init=function(){$(".auth_login_block").html(""),$(".auth_login_block").append(this.template),AUTH.activated?$(".auth_activated").show():$(".auth_unactivated").show()};var ResetController=function(parent_controller){this.parent_controller=parent_controller,this.template=reset_template};ResetController.prototype.init=function(){$(".auth_login_block").html(""),$(".auth_login_block").append(this.template),$(".auth_login_form").css({right:"100%",opacity:0}),$(".auth_login_form").animate({right:0,opacity:1},300)},ResetController.prototype.show_message=function(user){$(".auth_login-title").after(letter_sent_template),$(".auth_email").text(user.email),$("#auth_form").remove()},ResetController.prototype.callbacks={success:function(data){switch(data.code){case-1:this.parent_controller.error_handler(data.errors,$("#auth_form"));break;case 0:this.show_message(data.user),app.AuthService.return_to_site(AUTH.with_provider)}}};var UpdatePasswordController=function(parent_controller){this.parent_controller=parent_controller,this.template=update_password_template};UpdatePasswordController.prototype.init=function(){this.code=getUrlVars().code,$(".auth_login_block").html(""),$(".auth_login_block").append(this.template),$("#auth_code").val(this.code)},UpdatePasswordController.prototype.callbacks={success:function(data){switch(data.code){case-1:this.parent_controller.error_handler(data.errors,$("#auth_form"));break;case 0:$("#auth_form").after(password_changed_template),$("#auth_form").remove()}}};var SignUpController=function(parent_controller){this.parent_controller=parent_controller,this.template=signup_template};SignUpController.prototype.init=function(){$(".auth_login_block").html(""),$(".auth_login_block").append(auth_menu_template),$(".auth_login_block").append(auth_social_links_template),$(".auth_login_block").append(this.template),$(".auth_login_social_links, .auth_login_form").css({right:"100%",opacity:0}),$(".auth_login_social_links, .auth_login_form").animate({right:0,opacity:1},300),$(".auth_login_form-disclaimer").html("en"==AUTH.locale?disclaimer_template_en:disclaimer_template_ru),$(".auth_login_menu_links li").removeClass("active"),$(".auth_login_menu_links .signup").addClass("active")},SignUpController.prototype.callbacks={success:function(data){switch(data.code){case-2:this.parent_controller.error_handler(data.errors,$("#auth_form"));break;case 0:app.AuthService.loginByToken(data.user.single_access_token,function(){window.location.href=AUTH.provider_login})}}};var ProfileController=function(){this.template=profile_template};ProfileController.prototype.init=function(){("undefined"==typeof CurrentUser||null==CurrentUser.email||null==CurrentUser.single_access_token)&&(window.location.hash="signup"),$(".auth_login_block").html(""),$(".auth_login_block").append(this.template),$(".auth_login_form").css({right:"100%",opacity:0}),$(".auth_login_form").animate({right:0,opacity:1},300),$("span.auth_email").text(CurrentUser.email),$("input.auth_email").val(CurrentUser.email),$("input.auth_profile_full_name").val(CurrentUser.full_name.replace("+"," ")),$("input.auth_single_access_token").val(CurrentUser.single_access_token),CurrentUser.avatar_url&&$(".auth_login_form--profile-avatar").attr("src",CurrentUser.avatar_url)},ProfileController.prototype.callbacks={success:function(data){switch(console.log("ProfileController",data),data.code){case-2:this.error_handler(data.errors,$("#auth_form"));break;case 0:app.AuthService.loginByToken(data.user.single_access_token,function(){app.AuthService.login()})}}};var LoginController=function(parent_controller){this.parent_controller=parent_controller,this.template=sessions_template,this.stopInterval=1e3,this.stop=null};LoginController.prototype.init=function(){var logged_in=!1,is_loaded=!1,_this=this;this.show_spinner(),app.AuthService.isLogin(function(key,response){switch(response.code){case-2:CurrentUser=response.user,window.location.hash="profile";break;case 0:logged_in=!0,app.AuthService.login()
}is_loaded=!0}),this.stop=setInterval(function(){app.AuthService.remote_storage._isEmpty()&&(is_loaded=!1),app.AuthService.remote_storage._isEmpty()&&0==logged_in&&(is_loaded=!0,$(".auth_spinner_wrap").remove(),$(".auth_login_block").append(auth_social_links_template),$(".auth_login_block").append(_this.template),clearInterval(_this.stop),_this.stop=null)},this.stopInterval),$(".auth_login_menu_links li").removeClass("active"),$(".auth_login_menu_links .login").addClass("active")},LoginController.prototype.show_spinner=function(duration){duration=duration||500,$(".auth_login_block").html(""),$(".auth_login_block").append(auth_menu_template),$(".auth_login_block").append(spinner_template),$(".auth_spinner_wrap").animate({left:0,opacity:1},duration)},LoginController.prototype.destroy=function(){this.stop&&(clearInterval(this.stop),this.stop=null)},LoginController.prototype.callbacks={success:function(data){var _this=this;-1==data.code?this.parent_controller.error_handler(data.errors,$("#auth_form")):app.AuthService.loginByToken(data.user.single_access_token,function(key,value){-2==value.code&&(CurrentUser=value.user,window.location.hash="profile"),0==value.code&&(_this.show_spinner(300),app.AuthService.login())})}},AuthController.prototype.routing=function(){var routes={"#login":LoginController,"#/login":LoginController,"#signup":SignUpController,"#/signup":SignUpController,"#profile":ProfileController,"#/profile":ProfileController,"#reset":ResetController,"#/reset":ResetController,"#reset_password":UpdatePasswordController,"#/reset_password":UpdatePasswordController,"#activate":ActivationController,"#/activate":ActivationController,"#twitter_confirm":TwitterConfirmController,"#/twitter_confirm":TwitterConfirmController},CurrentController=routes[window.location.hash];return"undefined"==typeof CurrentController?void(this.initialized&&this.close(!1)):(0==this.initialized&&(this.root_el.addClass("auth_web_app").append(main_layout_template),AUTH.hide_close_button&&$(this.root_el.find(".auth_close")).remove(),$(".auth_sites_logo span."+AUTH.space).parent().addClass("active"),this.bg_loaded?this.bg_show($(".auth_bubbled")):$("<img/>").attr("src",$(".auth_bubbled").data("bg-loader")).load($.proxy(this.bg_load_handler,this)),this.initialized=!0),this.current_controller&&this.current_controller.destroy&&this.current_controller.destroy(),this.current_controller=new CurrentController(this),this.current_controller.init(),this.clear_errors(),void this.check_form_fullfill($("#auth_form")))},AuthController.prototype.submit_form=function(event){var form=$("#auth_form"),button=form.find(".auth_login_form-btn");if(event.preventDefault(),!this.request&&!button.hasClass("auth_login_form-btn--disabled")){this.clear_errors(),button.addClass("auth_login_form-btn--loading");var auth_url=form.attr("action").replace(/^https?/,AUTH.use_ssl===!0?"https":"http");this.request=$.ajax({url:auth_url,type:form.attr("method"),dataType:"json",data:form.serialize(),success:$.proxy(this.current_controller.callbacks.success,this.current_controller),error:$.proxy(this.error_handler,this,form),complete:$.proxy(this.complete_handler,this)})}return!1},AuthController.prototype.complete_handler=function(){delete this.request,$("#auth_form button").removeClass("auth_login_form-btn--loading")},AuthController.prototype.clear_errors=function(){{var form=$("#auth_form");form.find("input").removeClass("auth_login_form-text-input--error"),form.find(".auth_login_form-error-tooltip").remove()}this.root_el.find(".auth_top_errors_block").remove()},AuthController.prototype.error_handler=function(errors,form){this.root_el.find(".auth_bubbled.auth_mobile").append(error_mobile_template),$.each(errors,$.proxy(this.show_error,this,form)),this.shake_form(form)},AuthController.prototype.show_error=function(form,k,v){var splited=k.split("."),k=splited[splited.length-1];form.find('[name*="'+k+'"]').addClass("auth_login_form-text-input--error").after($.tmpl(error_template,{message:v.join("<br>")})),$(".auth_top_errors_block").append($.tmpl("<li>${message}</li>",{message:v.join("<br>")}))},AuthController.prototype.shake_form=function(form){$(form).effect("shake",{distance:10,times:2},300)},AuthController.prototype.keypress_handler=function(e){var input=$(e.target),form=input.closest("#auth_form");this.check_form_fullfill(form)},AuthController.prototype.keyup_handler=function(e){var input=$(e.target),form=input.closest("#auth_form"),key=e.keyCode||e.which;this.check_form_fullfill(form),13!==key&&input.removeClass("auth_login_form-text-input--error").next().remove()},AuthController.prototype.check_form_fullfill=function(form){var is_fullfilled=!0,button=form.find(".auth_login_form-btn");form.find("input").each(function(k,v){""===$(v).val()&&(is_fullfilled=!1)}),is_fullfilled?button.removeClass("auth_login_form-btn--disabled"):button.addClass("auth_login_form-btn--disabled")},AuthController.prototype.bg_show=function(layer){layer.addClass("auth_loaded")},AuthController.prototype.bg_load_handler=function(e){this.bg_show(this.root_el.find(".auth_bubbled")),$(e.target).remove(),this.bg_loaded=!0},AuthController.prototype.close=function(changeHash){changeHash=changeHash||!0,this.initialized=!1,changeHash&&(window.location.hash=""),this.root_el.removeClass("auth_web_app").find(".auth_bubbled").remove()};{var CurrentUser={};new AuthController}}(jQuery,AuthWeb);