<?xml version="1.0" encoding="UTF-8"?>
<!doctype html>
<html>
	<head>
		<style type="text/css">
			h2 {
				font: -apple-system-headline;
			}
			body {
				font: -apple-system-body;
				zoom: 1.2;
			}
			img {
				width: auto;
				height : auto;
				max-height: 100%;
				max-width: 100%;
			}
		</style>
	</head>
	<body>
		<h2>A Quick Tip For String Performance</h2>
		<p><img title="episode79-b380ab68.jpeg" src="https://www.objc.io/images/swift-talk/episode79-b380ab68.jpeg" alt="episode79-b380ab68.jpeg"></p><p>In this new post series we’ll show highlights of <a href="https://talk.objc.io/">Swift Talk</a>, our subscription video series. Today, we’ll show a very nice trick by <a href="https://oleb.net">Ole Begemann</a> to increase String processing performance.</p>  
  
<p>In <a href="https://talk.objc.io/episodes/S01E79-string-parsing-performance">Swift Talk 79</a>, we try to improve CSV string parsing performance by measuring time and comparing the performance of various techniques. To write a performance test, we wrap the parsing of the loaded string in an XCTest measure block:</p>  
  
<pre><code>func testPerformance() {  
    let bundle = Bundle(for: ParseCSVTests.self)  
    let url = bundle.url(forResource: "small", withExtension: "txt")!  
    let data = try! Data(contentsOf: url)  
    let string = String(data: data, encoding: .isoLatin1)!  
  
    measure {  
        _ = parse(lines: string)  
    }  
}  
</code></pre>  
  
<p>The change is a rather obscure tip we got from Ole:</p>  
  
<pre><code>let string = String(data: data, encoding: .isoLatin1)! + ""  
</code></pre>  
  
<p>When we append an empty string to the test string, we get a performance improvement of 18 percent:</p>  
  
<p><img width="1920" height="804" src="http://www.objc.io/images/swift-talk/episode79-b380ab68.jpeg" alt="episode79-b380ab68.jpeg"></p>  
  
<p>The reason for the performance gain: a string can be backed by a Swift <code>String</code> or an <code>NSString</code>. By appending an empty string, we force it to be backed by a Swift <code>String</code>, with which our algorithm works much faster.</p>  
  
<p>In the remainder of the episode, we also show a technique suggested by Matt Gallagher from <a href="https://cocoawithlove.com">Cocoa with Love</a>, and increase performance by another 83%. The episode and transcript are available for subscribers, and are part of the <a href="https://talk.objc.io/collections/swift-the-language">Swift, The Language</a> collection.</p>
	</body>
</html>
